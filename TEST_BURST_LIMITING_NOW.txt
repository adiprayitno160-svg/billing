====================================================================
🚀 TEST BURST LIMITING - SUDAH ADA FALLBACK MECHANISM
====================================================================

UPDATE TERBARU:
Sudah ditambahkan 2 cara untuk ambil data burst dari MikroTik:

1. ✅ Parse dari string "rate-limit" (format standard)
2. ✅ FALLBACK: Ambil dari field terpisah (burst-limit, burst-threshold, burst-time)

Sekarang HARUSNYA bisa ambil data burst dari berbagai versi RouterOS!

====================================================================
CARA TEST (STEP BY STEP):
====================================================================

STEP 1: UPDATE CODE DI SERVER
--------------------------------------------------------------------
cd /opt/billing
git pull origin main
npm run build
pm2 restart billing-app

⏳ Tunggu restart selesai (~10 detik)


STEP 2: BUKA PM2 LOGS (TERMINAL TERPISAH)
--------------------------------------------------------------------
Buka terminal/SSH baru, jalankan:

pm2 logs billing-app --lines 0

Biarkan tetap terbuka untuk monitoring real-time.


STEP 3: SYNC DARI MIKROTIK (DI BROWSER)
--------------------------------------------------------------------
1. Login ke billing system
2. Buka: /packages/pppoe/profiles
3. Klik: "🔄 Sync dari MikroTik"
4. Tunggu notifikasi sukses


STEP 4: LIHAT LOG PM2 (DI TERMINAL)
--------------------------------------------------------------------
Setelah klik sync, log akan muncul seperti ini:

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📡 Fetching PPP profiles with detail flag...
📊 Total profiles from MikroTik: 5

🔍 Processing profile: Paket-110k
  📋 All fields from MikroTik: .id, name, rate-limit, burst-limit, ...
  
  🔎 Checking separate fields: {
    'burst-rate': 'NOT FOUND',
    'burst-threshold': '15M/15M',        <-- BISA JADI ADA DI SINI!
    'burst-time': '10s/10s'              <-- ATAU DI SINI!
  }
  
  🔍 Parsing rate-limit string: "10M/10M 50M/50M 15M/15M 10s/10s 8"
  📦 Split parts (5): [ '10M/10M', '50M/50M', '15M/15M', '10s/10s', '8' ]
  
  ✅ Burst limits: RX="50M", TX="50M"
  ✅ Burst thresholds: RX="15M", TX="15M"
  ✅ Burst times: RX="10s", TX="10s"
  
  📊 FINAL BURST DATA for Paket-110k: {      <-- INI YANG PENTING!
    'burst_limit_rx': '50M',                  <-- HARUS TERISI
    'burst_limit_tx': '50M',                  <-- HARUS TERISI
    'burst_threshold_rx': '15M',              <-- HARUS TERISI
    'burst_threshold_tx': '15M',              <-- HARUS TERISI
    'burst_time_rx': '10s',                   <-- HARUS TERISI
    'burst_time_tx': '10s'                    <-- HARUS TERISI
  }
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━


STEP 5: JIKA MASIH EMPTY - CEK FALLBACK
--------------------------------------------------------------------
Jika parsing dari rate-limit string gagal, akan ada log FALLBACK:

  🔄 FALLBACK: Got burst-limit from separate field: RX="50M", TX="50M"
  🔄 FALLBACK: Got burst-threshold from separate field: RX="15M", TX="15M"
  🔄 FALLBACK: Got burst-time from separate field: RX="10s", TX="10s"

Ini berarti data burst diambil dari field terpisah, BUKAN dari rate-limit string.


STEP 6: VERIFIKASI DI BROWSER
--------------------------------------------------------------------
1. Refresh halaman: /packages/pppoe/profiles
2. Cek kolom burst limiting
3. Jika data muncul: ✅ SUKSES!
4. Jika masih kosong: ❌ Lanjut ke troubleshooting


====================================================================
TROUBLESHOOTING:
====================================================================

CASE 1: LOG MENUNJUKKAN "FINAL BURST DATA" SEMUA EMPTY
--------------------------------------------------------------------
  📊 FINAL BURST DATA for Paket-110k: {
    'burst_limit_rx': 'EMPTY',
    'burst_limit_tx': 'EMPTY',
    'burst_threshold_rx': 'EMPTY',
    'burst_threshold_tx': 'EMPTY',
    'burst_time_rx': 'EMPTY',
    'burst_time_tx': 'EMPTY'
  }

ARTINYA:
MikroTik TIDAK mengirim data burst untuk profile ini.

SOLUSI:
Cek di MikroTik Winbox:
1. PPP > Profiles > [Pilih profile]
2. Tab "Rate Limit"
3. Pastikan field ini TERISI:
   - Max Limit: 10M/10M
   - Burst Limit: 50M/50M
   - Burst Threshold: 15M/15M
   - Burst Time: 10s/10s
4. Apply
5. Kembali ke billing, klik "Sync dari MikroTik" lagi


CASE 2: LOG ADA DATA TAPI DI BROWSER MASIH KOSONG
--------------------------------------------------------------------
  📊 FINAL BURST DATA for Paket-110k: {
    'burst_limit_rx': '50M',
    'burst_limit_tx': '50M',
    ...
  }

Tapi di browser tetap dash (-).

SOLUSI:
1. Cek log database insert/update:
   
   🔄 Update profil yang sudah ada: Paket-110k
   ✅ Profil Paket-110k berhasil di-sync
   
2. Jika ada error SQL, kirim screenshot
3. Jika tidak ada error, coba:
   
   # Di server
   pm2 restart billing-app
   
   # Di browser
   Hard refresh: Ctrl+Shift+R


CASE 3: FORMAT DATA ANEH (Tidak standard)
--------------------------------------------------------------------
  🔍 Parsing rate-limit string: "rx-rate=10M tx-rate=10M ..."

SOLUSI:
Kirim screenshot FULL log untuk 1 profile ke developer.


====================================================================
CONTOH LOG SUKSES:
====================================================================

🔍 Processing profile: Paket-110k
  📋 All fields from MikroTik: .id, name, local-address, remote-address, rate-limit
  
  🔍 Parsing rate-limit string: "10M/10M 50M/50M 15M/15M 10s/10s 8"
  📦 Split parts (5): [ '10M/10M', '50M/50M', '15M/15M', '10s/10s', '8' ]
  ✅ Rate limits: RX="10M", TX="10M"
  ✅ Burst limits: RX="50M", TX="50M"
  ✅ Burst thresholds: RX="15M", TX="15M"
  ✅ Burst times: RX="10s", TX="10s"
  
  📊 FINAL BURST DATA for Paket-110k: {
    'burst_limit_rx': '50M',
    'burst_limit_tx': '50M',
    'burst_threshold_rx': '15M',
    'burst_threshold_tx': '15M',
    'burst_time_rx': '10s',
    'burst_time_tx': '10s'
  }

📊 Burst Data: {
  'burst-limit-rx': '50M',
  'burst-limit-tx': '50M',
  'burst-threshold-rx': '15M',
  'burst-threshold-tx': '15M',
  'burst-time-rx': '10s',
  'burst-time-tx': '10s'
}
✅ Profil Paket-110k berhasil di-sync

Lalu di browser:
Kolom "Burst RX", "Threshold RX", "Time RX", dll TERISI!


====================================================================
CEK MANUAL DI MIKROTIK:
====================================================================

Untuk memastikan MikroTik punya data burst, cek via Winbox:

1. PPP > Profiles
2. Pilih profile (contoh: Paket-110k)
3. Tab "Rate Limit"
4. Pastikan terisi:
   
   Max Limit: 10M/10M
   Burst Limit: 50M/50M          <-- HARUS ADA
   Burst Threshold: 15M/15M      <-- HARUS ADA
   Burst Time: 10s/10s           <-- HARUS ADA
   Priority: 8

Atau via Terminal:
/ppp profile print detail

Cari output:
rate-limit=10M/10M 50M/50M 15M/15M 10s/10s 8
          ^^^^^^^ ^^^^^^^ ^^^^^^^^ ^^^^^^^^
          rate    burst   threshold time


====================================================================
QUICK COMMAND (ALL IN ONE):
====================================================================

cd /opt/billing && \
git pull origin main && \
npm run build && \
pm2 restart billing-app && \
echo "✅ Server updated! Sekarang:" && \
echo "1. Buka terminal baru: pm2 logs billing-app --lines 0" && \
echo "2. Buka browser: klik Sync dari MikroTik" && \
echo "3. Lihat log untuk FINAL BURST DATA"

====================================================================

SETELAH TEST, KIRIM:
1. Screenshot log PM2 untuk 1 profile lengkap
2. Screenshot halaman /packages/pppoe/profiles
3. Info versi RouterOS MikroTik

====================================================================

