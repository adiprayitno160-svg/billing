<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Invoice - <%= invoice.invoice_number %>
    </title>
    <style>
        /* RESET & BASE */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #e5e7eb;
            color: #1f2937;
        }

        /* UTILITIES */
        .no-print {
            background: #374151;
            padding: 15px;
            color: white;
            display: flex;
            justify-content: center;
            gap: 15px;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        button {
            cursor: pointer;
            padding: 10px 20px;
            border-radius: 6px;
            border: none;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s;
        }

        .btn-a4 {
            background: #2563eb;
            color: white;
        }

        .btn-a4:hover {
            background: #1d4ed8;
        }

        .btn-thermal {
            background: #059669;
            color: white;
        }

        .btn-thermal:hover {
            background: #047857;
        }

        .btn-close {
            background: #ef4444;
            color: white;
        }

        .btn-close:hover {
            background: #dc2626;
        }

        /* ==== A4 MODE STYLES ==== */
        .page-a4 {
            background: white;
            width: 210mm;
            min-height: 297mm;
            margin: 20px auto;
            padding: 20mm;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            display: block;
        }

        .a4-header {
            display: flex;
            justify-content: space-between;
            border-bottom: 2px solid #2563eb;
            padding-bottom: 20px;
            margin-bottom: 30px;
        }

        .a4-title {
            font-size: 24pt;
            font-weight: 800;
            color: #2563eb;
            text-transform: uppercase;
        }

        .a4-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        .a4-table th {
            background: #f3f4f6;
            padding: 12px;
            text-align: left;
            border-bottom: 2px solid #e5e7eb;
            font-size: 10pt;
            text-transform: uppercase;
            color: #6b7280;
        }

        .a4-table td {
            padding: 12px;
            border-bottom: 1px solid #e5e7eb;
            font-size: 11pt;
        }

        .a4-totals {
            width: 40%;
            margin-left: auto;
            margin-top: 20px;
        }

        .a4-totals td {
            padding: 8px;
            border-bottom: 1px solid #e5e7eb;
        }

        .a4-totals .total-final {
            font-weight: bold;
            font-size: 14pt;
            color: #2563eb;
            border-top: 2px solid #2563eb;
        }

        /* ==== THERMAL MODE STYLES (58mm) ==== */
        .page-thermal {
            display: none;
            background: white;
            width: 58mm;
            margin: 20px auto;
            padding: 2mm 5px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            font-family: 'Courier New', Courier, monospace;
            font-size: 12px;
            line-height: 1.2;
            color: black;
        }

        .th-center {
            text-align: center;
        }

        .th-right {
            text-align: right;
        }

        .th-bold {
            font-weight: bold;
        }

        .th-line {
            border-top: 1px dashed black;
            margin: 5px 0;
        }

        .th-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 3px;
        }

        .th-total {
            font-size: 14px;
            font-weight: bold;
            margin-top: 5px;
        }

        /* ==== PRINT MEDIA QUERIES ==== */
        @media print {
            .no-print {
                display: none !important;
            }

            body {
                background: white;
            }

            /* Logic to switch views based on body class */
            body:not(.mode-thermal) .page-thermal {
                display: none !important;
            }

            body:not(.mode-thermal) .page-a4 {
                display: block !important;
                width: 100%;
                margin: 0;
                box-shadow: none;
                page-break-after: always;
            }

            /* Thermal Mode */
            body.mode-thermal .page-a4 {
                display: none !important;
            }

            body.mode-thermal .page-thermal {
                display: block !important;
                width: 100%;
                margin: 0;
                padding: 0;
                box-shadow: none;
            }

            body.mode-thermal {
                width: 58mm;
            }

            @page {
                margin: 0;
            }
        }
    </style>
</head>

<body>
    <!-- CONTROLS -->
    <div class="no-print">
        <button onclick="setMode('a4'); window.print()" class="btn-a4">
            Print Format A4
        </button>
        <button onclick="setMode('thermal'); window.print()" class="btn-thermal">
            Print Struk (Thermal/HP)
        </button>
        <button onclick="window.close()" class="btn-close">
            Tutup
        </button>
    </div>

    <!-- VIEW: A4 INVOICE -->
    <div class="page-a4">
        <div class="a4-header">
            <div>
                <div class="a4-title">INVOICE</div>
                <div style="color: #6b7280; margin-top: 5px;">
                    #<%= invoice.invoice_number %>
                </div>
            </div>
            <div style="text-align: right;">
                <div style="font-weight: bold; font-size: 16pt; margin-bottom: 5px;">BILLING SYSTEM</div>
                <div style="font-size: 10pt; color: #4b5563;">
                    Jl. Internet No. 123<br>
                    Kota Digital - Indonesia
                </div>
            </div>
        </div>

        <!-- Customer & Date -->
        <table style="width: 100%; margin-bottom: 30px;">
            <tr>
                <td style="width: 50%; vertical-align: top;">
                    <strong style="color: #6b7280; font-size: 10pt; text-transform: uppercase;">Ditagihkan
                        Kepada:</strong><br>
                    <div style="font-size: 14pt; font-weight: bold; color: #1f2937; margin-top: 5px;">
                        <%= invoice.customer_name %>
                    </div>
                    <% if (invoice.customer_address) { %>
                        <div style="margin-top: 2px;">
                            <%= invoice.customer_address %>
                        </div>
                        <% } %>
                            <% if (invoice.customer_phone) { %>
                                <div>
                                    <%= invoice.customer_phone %>
                                </div>
                                <% } %>
                </td>
                <td style="width: 50%; vertical-align: top; text-align: right;">
                    <table style="width: 100%; text-align: right;">
                        <tr>
                            <td style="color: #6b7280; padding-bottom: 5px;">Tanggal Invoice:</td>
                            <td style="font-weight: bold; padding-bottom: 5px;">
                                <%= new Date(invoice.created_at).toLocaleDateString('id-ID', { day: 'numeric' ,
                                    month: 'long' , year: 'numeric' }) %>
                            </td>
                        </tr>
                        <tr>
                            <td style="color: #6b7280; padding-bottom: 5px;">Jatuh Tempo:</td>
                            <td style="font-weight: bold; padding-bottom: 5px;">
                                <%= new Date(invoice.due_date).toLocaleDateString('id-ID', { day: 'numeric' ,
                                    month: 'long' , year: 'numeric' }) %>
                            </td>
                        </tr>
                        <tr>
                            <td style="color: #6b7280;">Status:</td>
                            <td>
                                <% if (invoice.status==='paid' ) { %>
                                    <span
                                        style="background: #d1fae5; color: #065f46; padding: 4px 8px; border-radius: 4px; font-size: 10pt; font-weight: bold;">LUNAS</span>
                                    <% } else { %>
                                        <span
                                            style="background: #fee2e2; color: #991b1b; padding: 4px 8px; border-radius: 4px; font-size: 10pt; font-weight: bold;">BELUM
                                            LUNAS</span>
                                        <% } %>
                            </td>
                        </tr>
                    </table>
                </td>
            </tr>
        </table>

        <!-- Items -->
        <table class="a4-table">
            <thead>
                <tr>
                    <th style="width: 5%;">No</th>
                    <th style="width: 55%;">Deskripsi Layanan</th>
                    <th style="width: 20%; text-align: right;">Harga</th>
                    <th style="width: 20%; text-align: right;">Total</th>
                </tr>
            </thead>
            <tbody>
                <% if (items && items.length> 0) { %>
                    <% items.forEach((item, index)=> { %>
                        <tr>
                            <td>
                                <%= index + 1 %>
                            </td>
                            <td>
                                <%= item.description %>
                            </td>
                            <td style="text-align: right;">Rp <%= new Intl.NumberFormat('id-ID').format(item.unit_price)
                                    %>
                            </td>
                            <td style="text-align: right;">Rp <%= new
                                    Intl.NumberFormat('id-ID').format(item.total_price) %>
                            </td>
                        </tr>
                        <% }); %>
                            <% } %>
            </tbody>
        </table>

        <!-- Totals -->
        <table class="a4-totals">
            <tr>
                <td>Subtotal</td>
                <td style="text-align: right;">Rp <%= new Intl.NumberFormat('id-ID').format(invoice.subtotal || 0) %>
                </td>
            </tr>
            <% if (invoice.discount_amount> 0) { %>
                <tr>
                    <td>Diskon</td>
                    <td style="text-align: right; color: #dc2626;">- Rp <%= new
                            Intl.NumberFormat('id-ID').format(invoice.discount_amount) %>
                    </td>
                </tr>
                <% } %>
                    <% if (invoice.ppn_amount> 0) { %>
                        <tr>
                            <td>PPN (<%= invoice.ppn_rate %>%)</td>
                            <td style="text-align: right;">Rp <%= new
                                    Intl.NumberFormat('id-ID').format(invoice.ppn_amount) %>
                            </td>
                        </tr>
                        <% } %>
                            <tr class="total-final">
                                <td>TOTAL TAGIHAN</td>
                                <td style="text-align: right;">Rp <%= new
                                        Intl.NumberFormat('id-ID').format(invoice.total_amount) %>
                                </td>
                            </tr>
        </table>

        <!-- Footer -->
        <div style="margin-top: 50px; text-align: center; color: #9ca3af; font-size: 10pt;">
            <hr style="border: 0; border-top: 1px solid #e5e7eb; margin-bottom: 20px;">
            Terima kasih atas kepercayaan Anda.<br>
            Pembayaran dapat dilakukan melalui transfer atau loket pembayaran terdekat.
        </div>
    </div>

    <!-- VIEW: THERMAL / STRUK (58MM) -->
    <div class="page-thermal">
        <div class="th-center font-bold" style="font-size: 16px; margin-bottom: 5px;">BILLING SYSTEM</div>
        <div class="th-center">Jl. Internet No. 123</div>
        <div class="th-center">Telp: (021) 1234-5678</div>
        <div class="th-line"></div>

        <div style="display: flex; justify-content: space-between;">
            <span>Tgl: <%= new Date().toLocaleDateString('id-ID', {day: '2-digit' , month: '2-digit' , year: 'numeric'
                    }) %></span>
            <span>Jam: <%= new Date().toLocaleTimeString('id-ID', {hour: '2-digit' , minute: '2-digit' }) %></span>
        </div>
        <div class="th-line"></div>

        <div>
            <strong>Plg:</strong>
            <%= invoice.customer_name %>
        </div>
        <div>
            <strong>Inv:</strong>
            <%= invoice.invoice_number %>
        </div>
        <div class="th-line"></div>

        <!-- Items Thermal -->
        <% if (items && items.length> 0) { %>
            <% items.forEach((item)=> { %>
                <div style="margin-bottom: 5px;">
                    <div>
                        <%= item.description %>
                    </div>
                    <div style="display: flex; justify-content: space-between;">
                        <span>
                            <%= item.quantity || 1 %> x <%= new Intl.NumberFormat('id-ID').format(item.unit_price) %>
                        </span>
                        <span>
                            <%= new Intl.NumberFormat('id-ID').format(item.total_price) %>
                        </span>
                    </div>
                </div>
                <% }); %>
                    <% } %>

                        <div class="th-line"></div>

                        <div class="th-item">
                            <span>Total Tagihan:</span>
                            <span class="th-bold">Rp <%= new Intl.NumberFormat('id-ID').format(invoice.total_amount) %>
                            </span>
                        </div>

                        <% if (invoice.status==='paid' ) { %>
                            <div class="th-item">
                                <span>Status:</span>
                                <span class="th-bold">LUNAS</span>
                            </div>
                            <% } else { %>
                                <div class="th-item">
                                    <span>Status:</span>
                                    <span>BELUM BAYAR</span>
                                </div>
                                <% } %>

                                    <div class="th-line"></div>
                                    <div class="th-center" style="margin-top: 10px;">
                                        *** TERIMA KASIH ***<br>
                                        Simpan struk ini sebagai<br>bukti pembayaran sah.
                                    </div>
                                    <br>
                                    <div class="th-center">.</div>
    </div>

    <script>
        function setMode(mode) {
            if (mode === 'thermal') {
                document.body.classList.add('mode-thermal');
            } else {
                document.body.classList.remove('mode-thermal');
            }
        }

        // Auto determine if mobile?
        if (window.innerWidth < 600) {
            // Optional: Auto switch to thermal on mobile
            // setMode('thermal'); 
        }
    </script>
</body>

</html>