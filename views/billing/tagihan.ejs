<style>
    /* Prevent horizontal overflow */
    body {
        overflow-x: hidden;
    }

    .table-container {
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
    }

    /* Make buttons more responsive */
    button[data-action] {
        min-width: auto !important;
        flex-shrink: 0;
    }

    /* Ensure main content doesn't overflow */
    main {
        max-width: 100%;
        overflow-x: hidden;
    }

    /* Bulk items visibility */
    .bulk-delete-hidden {
        display: none !important;
    }

    .bulk-delete-visible {
        display: inline-flex !important;
    }

    /* Button gradients */
    .bg-wa-gradient {
        background: linear-gradient(135deg, #25D366 0%, #128C7E 100%);
    }
</style>

<!-- Action Buttons Section -->
<div class="glass-panel shadow-lg rounded-2xl mb-6 p-6 overflow-x-auto">
    <div class="flex flex-nowrap md:flex-wrap gap-4 items-center min-w-max md:min-w-0">
        <!-- Generate Tagihan -->
        <button type="button" id="btnGenerateTagihan" data-action="generate-invoice"
            class="inline-flex items-center bg-gradient-to-r from-emerald-500 to-green-600 hover:from-emerald-600 hover:to-green-700 text-white px-5 py-2.5 rounded-xl font-bold shadow-lg hover:shadow-green-500/30 transition-all duration-300 transform hover:-translate-y-0.5">
            <i class="fas fa-file-invoice mr-2 text-lg"></i>Generate
        </button>

        <!-- Print Area ODC -->
        <button type="button" id="btnPrintODC" onclick="showOdcPrintModal()"
            class="inline-flex items-center bg-gradient-to-r from-cyan-500 to-blue-600 hover:from-cyan-600 hover:to-blue-700 text-white px-5 py-2.5 rounded-xl font-bold shadow-lg hover:shadow-cyan-500/30 transition-all duration-300 transform hover:-translate-y-0.5">
            <i class="fas fa-map-marked-alt mr-2 text-lg"></i>Print Area
        </button>

        <div class="hidden md:block h-8 w-px bg-gray-200 mx-1"></div>

        <!-- Kirim Masal (Pindah ke samping Export sesuai permintaan) -->
        <button type="button" id="btnBulkSendWA"
            class="inline-flex items-center bg-gradient-to-r from-green-600 to-emerald-700 hover:from-green-700 hover:to-emerald-800 text-white px-5 py-2.5 rounded-xl font-bold shadow-lg hover:shadow-green-500/30 transition-all duration-300 transform hover:-translate-y-0.5"
            title="Kirim tagihan terpilih ke antrian WhatsApp">
            <i class="fab fa-whatsapp mr-2 text-xl"></i>Kirim Masal (<span id="selectedSendWACount">0</span>)
        </button>

        <!-- Export PDF -->
        <button type="button" id="btnExportPDF" data-action="export-pdf"
            class="inline-flex items-center bg-gradient-to-r from-indigo-500 to-purple-600 hover:from-indigo-600 hover:to-purple-700 text-white px-5 py-2.5 rounded-xl font-bold shadow-lg hover:shadow-indigo-500/30 transition-all duration-300 transform hover:-translate-y-0.5">
            <i class="fas fa-file-pdf mr-2 text-lg"></i>Export PDF
        </button>

        <div class="hidden md:block h-8 w-px bg-gray-200 mx-1"></div>

        <!-- Bulk Actions (Hanya muncul jika ada yang dipilih) -->
        <div class="flex items-center gap-3">
            <button type="button" id="bulkDeleteBtn" data-action="bulk-delete"
                class="bulk-delete-hidden inline-flex items-center bg-gradient-to-r from-red-500 to-rose-600 hover:from-red-600 hover:to-rose-700 text-white px-5 py-2.5 rounded-xl font-bold shadow-lg transition-all transform hover:-translate-y-0.5">
                <i class="fas fa-trash-alt mr-2"></i>Hapus Terpilih
            </button>

            <button type="button" id="btnPrintSelected"
                class="bulk-delete-hidden inline-flex items-center bg-gradient-to-r from-violet-500 to-fuchsia-600 hover:from-violet-600 hover:to-fuchsia-700 text-white px-5 py-2.5 rounded-xl font-bold shadow-lg transition-all transform hover:-translate-y-0.5">
                <i class="fas fa-check-double mr-2"></i>Print Terpilih
            </button>
        </div>

        <button type="button" id="btnPrintAll" data-action="print-all"
            class="hidden lg:inline-flex items-center bg-gray-600 hover:bg-gray-700 text-white px-5 py-2.5 rounded-xl font-bold transition-all">
            <i class="fas fa-print mr-2"></i>Print Semua
        </button>
    </div>
</div>

<!-- Filters -->
<div class="glass-panel rounded-2xl shadow-lg p-6 mb-6">
    <form method="GET">
        <div class="flex flex-wrap items-end gap-4">
            <!-- Status Filter -->
            <div class="flex-1 min-w-[180px]">
                <label class="block text-xs font-bold text-gray-500 uppercase tracking-wider mb-2">Status</label>
                <div class="relative">
                    <select name="status"
                        class="w-full pl-4 pr-10 py-2.5 text-sm bg-white/50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 appearance-none backdrop-blur-sm transition-all duration-300 hover:bg-white/80">
                        <option value="">Semua Status</option>
                        <option value="draft" <%=filters.status==='draft' ? 'selected' : '' %>>Draft</option>
                        <option value="sent" <%=filters.status==='sent' ? 'selected' : '' %>>Terkirim</option>
                        <option value="partial" <%=filters.status==='partial' ? 'selected' : '' %>>Dibayar Sebagian
                        </option>
                        <option value="paid" <%=filters.status==='paid' ? 'selected' : '' %>>Lunas</option>
                        <option value="overdue" <%=filters.status==='overdue' ? 'selected' : '' %>>Jatuh Tempo</option>
                        <option value="cancelled" <%=filters.status==='cancelled' ? 'selected' : '' %>>Dibatalkan
                        </option>
                    </select>
                    <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-3 text-gray-500">
                        <i class="fas fa-chevron-down text-xs"></i>
                    </div>
                </div>
            </div>

            <!-- Isolir Filter -->
            <div class="flex-1 min-w-[180px]">
                <label class="block text-xs font-bold text-gray-500 uppercase tracking-wider mb-2">Pelanggan
                    Isolir</label>
                <div class="relative">
                    <select name="hide_isolated"
                        class="w-full pl-4 pr-10 py-2.5 text-sm bg-white/50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-orange-500 focus:border-orange-500 appearance-none backdrop-blur-sm transition-all duration-300 hover:bg-white/80">
                        <option value="">Tampilkan Semua</option>
                        <option value="1" <%=filters.hide_isolated==='1' || filters.hide_isolated===true ? 'selected'
                            : '' %>>🚫 Sembunyikan Isolir</option>
                        <option value="only" <%=filters.hide_isolated==='only' ? 'selected' : '' %>>⚠️ Hanya Isolir
                        </option>
                    </select>
                    <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-3 text-gray-500">
                        <i class="fas fa-chevron-down text-xs"></i>
                    </div>
                </div>
            </div>

            <!-- ODC Filter -->
            <div class="flex-1 min-w-[180px]">
                <label class="block text-xs font-bold text-gray-500 uppercase tracking-wider mb-2">Area ODC</label>
                <div class="relative">
                    <select name="odc_id"
                        class="w-full pl-4 pr-10 py-2.5 text-sm bg-white/50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 appearance-none backdrop-blur-sm transition-all duration-300 hover:bg-white/80">
                        <option value="">Semua ODC</option>
                        <% if (typeof odcList !=='undefined' && odcList && odcList.length> 0) { %>
                            <% odcList.forEach(function(odc) { %>
                                <option value="<%= odc.id %>" <%=filters.odc_id==odc.id ? 'selected' : '' %>><%=
                                        odc.name %>
                                </option>
                                <% }); %>
                                    <% } %>
                    </select>
                    <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-3 text-gray-500">
                        <i class="fas fa-chevron-down text-xs"></i>
                    </div>
                </div>
            </div>

            <!-- Search Input -->
            <div class="flex-1 min-w-[250px]">
                <label class="block text-xs font-bold text-gray-500 uppercase tracking-wider mb-2">Cari</label>
                <div class="relative">
                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                        <i class="fas fa-search text-gray-400"></i>
                    </div>
                    <input type="text" name="search" value="<%= filters.search %>"
                        placeholder="Nama, telepon, atau nomor tagihan..."
                        class="w-full pl-10 pr-4 py-2.5 text-sm bg-white/50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 backdrop-blur-sm transition-all duration-300 hover:bg-white/80">
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="flex gap-2">
                <button type="submit"
                    class="bg-blue-600 text-white px-6 py-2.5 rounded-xl hover:bg-blue-700 transition-all duration-300 text-sm font-bold shadow-md hover:shadow-lg hover:-translate-y-0.5">
                    Filter
                </button>
                <a href="/billing/tagihan"
                    class="bg-white text-gray-700 border border-gray-200 px-6 py-2.5 rounded-xl hover:bg-gray-50 transition-all duration-300 text-center text-sm font-bold shadow-sm hover:shadow-md hover:-translate-y-0.5">
                    Reset
                </a>
            </div>
        </div>
    </form>
</div>

<!-- Invoices Table -->
<!-- Invoices Table -->
<div class="glass-panel rounded-2xl shadow-xl overflow-hidden border border-white/20 relative z-0">
    <div class="px-6 py-5 border-b border-gray-200/50 bg-white/40 backdrop-blur-md flex justify-between items-center">
        <div>
            <h3 class="text-lg font-bold text-gray-900 tracking-tight">Daftar Tagihan</h3>
            <p class="text-xs font-medium text-gray-500 mt-0.5">Total <%= pagination.totalCount %> tagihan</p>
        </div>
        <div class="flex items-center gap-2">
            <span class="inline-flex h-2 w-2 rounded-full bg-green-500 animate-pulse"></span>
            <span class="text-xs text-gray-500 font-medium">Live Data</span>
        </div>
    </div>

    <div class="overflow-x-auto">
        <table class="w-full text-sm text-left">
            <thead>
                <tr
                    class="bg-gradient-to-r from-gray-50/80 to-slate-50/80 border-b border-gray-200/60 text-xs uppercase tracking-wider font-bold text-gray-600 font-mono">
                    <th class="px-6 py-4 w-12 text-center">
                        <input type="checkbox" id="selectAll"
                            class="rounded border-gray-300 text-blue-600 focus:ring-blue-500 shadow-sm transition-all duration-200">
                    </th>
                    <th class="px-6 py-4">No. Tagihan</th>
                    <th class="px-6 py-4">Pelanggan</th>
                    <th class="px-6 py-4">Area ODC</th>
                    <th class="px-6 py-4 text-right">Jumlah</th>
                    <th class="px-6 py-4 text-center">Status</th>
                    <th class="px-6 py-4">Tanggal</th>
                    <th class="px-6 py-4">Jatuh Tempo</th>
                    <th class="px-6 py-4 text-center">Aksi</th>
                </tr>
            </thead>
            <tbody class="divide-y divide-gray-100 bg-white/30 backdrop-blur-sm">
                <% if (invoices && invoices.length> 0) { %>
                    <% invoices.forEach(function(invoice) { %>
                        <tr class="hover:bg-blue-50/40 transition-colors duration-200 group">
                            <td class="px-6 py-4 text-center">
                                <input type="checkbox"
                                    class="invoice-checkbox rounded border-gray-300 text-blue-600 focus:ring-blue-500 shadow-sm cursor-pointer transition-all duration-200 transform hover:scale-110"
                                    value="<%= invoice.id %>">
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <span
                                    class="font-mono text-xs font-bold bg-slate-100 text-slate-700 px-2 py-1 rounded border border-slate-200 group-hover:bg-white group-hover:border-blue-200 transition-colors">
                                    <%= invoice.invoice_number %>
                                </span>
                            </td>
                            <td class="px-6 py-4">
                                <div class="font-bold text-gray-900 group-hover:text-blue-700 transition-colors">
                                    <%= invoice.customer_name %>
                                </div>
                                <div class="text-xs text-gray-500 font-mono mt-0.5">
                                    <button data-action="send-wanew" data-invoice-id="<%= invoice.id %>"
                                        class="flex items-center gap-1 hover:text-emerald-600 transition-colors"
                                        title="Kirim WA Langsung">
                                        <i class="fas fa-phone-alt text-[10px]"></i>
                                        <%= invoice.customer_phone %>
                                    </button>
                                </div>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <% if (invoice.odc_name) { %>
                                    <div class="flex flex-col">
                                        <div class="text-xs font-semibold text-gray-700 flex items-center gap-1.5">
                                            <i class="fas fa-building text-cyan-600"></i>
                                            <%= invoice.odc_name %>
                                        </div>
                                        <span class="text-[10px] text-gray-400 pl-4">
                                            <%= invoice.odc_location || '-' %>
                                        </span>
                                    </div>
                                    <% } else { %>
                                        <span class="text-xs text-gray-400 italic flex items-center gap-1">
                                            <i class="fas fa-ban text-gray-300"></i> No ODC
                                        </span>
                                        <% } %>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-right">
                                <div class="font-bold text-gray-900 font-mono tracking-tight">
                                    Rp <%= new Intl.NumberFormat('id-ID').format(invoice.total_amount) %>
                                </div>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-center">
                                <% let statusClass='' ; let statusIcon='' ; let statusText='' ; switch(invoice.status) {
                                    case 'paid' : statusClass='bg-green-100 text-green-700 border border-green-200' ;
                                    statusIcon='fa-check-circle' ; statusText='Lunas' ; break; case 'draft' :
                                    statusClass='bg-gray-100 text-gray-700 border border-gray-200' ;
                                    statusIcon='fa-pencil-alt' ; statusText='Draft' ; break; case 'sent' :
                                    statusClass='bg-blue-100 text-blue-700 border border-blue-200' ;
                                    statusIcon='fa-paper-plane' ; statusText='Terkirim' ; break; case 'partial' :
                                    statusClass='bg-amber-100 text-amber-700 border border-amber-200' ;
                                    statusIcon='fa-adjust' ; statusText='Partial' ; break; case 'overdue' :
                                    statusClass='bg-red-100 text-red-700 border border-red-200' ;
                                    statusIcon='fa-exclamation-circle' ; statusText='Telat' ; break; case 'cancelled' :
                                    statusClass='bg-slate-100 text-slate-500 border border-slate-200 decoration-line-through'
                                    ; statusIcon='fa-times-circle' ; statusText='Batal' ; break; default:
                                    statusClass='bg-gray-100 text-gray-600' ; statusIcon='fa-question-circle' ;
                                    statusText=invoice.status; } %>
                                    <span
                                        class="inline-flex items-center gap-1.5 px-2.5 py-1 text-[11px] font-bold uppercase tracking-wide rounded-full shadow-sm <%= statusClass %>">
                                        <i class="fas <%= statusIcon %> text-[10px]"></i>
                                        <%= statusText %>
                                    </span>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-xs text-gray-500 font-medium">
                                <%= new Date(invoice.created_at).toLocaleDateString('id-ID', {day: '2-digit' ,
                                    month: 'short' , year: 'numeric' }) %>
                            </td>
                            <td
                                class="px-6 py-4 whitespace-nowrap text-xs font-medium <%= new Date(invoice.due_date) < new Date() && invoice.status !== 'paid' ? 'text-red-600 font-bold' : 'text-gray-500' %>">
                                <%= new Date(invoice.due_date).toLocaleDateString('id-ID', {day: '2-digit' ,
                                    month: 'short' , year: 'numeric' }) %>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-center">
                                <div
                                    class="flex items-center justify-center gap-1 opacity-80 group-hover:opacity-100 transition-opacity">
                                    <!-- Detail -->
                                    <button data-action="detail" data-invoice-id="<%= invoice.id %>"
                                        class="w-8 h-8 rounded-lg flex items-center justify-center text-blue-600 hover:bg-blue-100 hover:text-blue-700 transition-all"
                                        title="Detail">
                                        <i class="fas fa-eye"></i>
                                    </button>

                                    <!-- Janji Bayar -->
                                    <button data-action="promise" data-invoice-id="<%= invoice.id %>"
                                        data-invoice-date="<%= invoice.due_date %>"
                                        class="w-8 h-8 rounded-lg flex items-center justify-center text-indigo-600 hover:bg-indigo-100 hover:text-indigo-700 transition-all"
                                        title="Janji Bayar">
                                        <i class="fas fa-calendar-alt"></i>
                                    </button>

                                    <!-- WhatsApp -->
                                    <% if (invoice.status !=='paid' ) { %>
                                        <button data-action="send-wanew" data-invoice-id="<%= invoice.id %>"
                                            class="w-8 h-8 rounded-lg flex items-center justify-center text-emerald-600 hover:bg-emerald-100 hover:text-emerald-700 transition-all"
                                            title="Kirim WhatsApp">
                                            <i class="fab fa-whatsapp"></i>
                                        </button>
                                        <% } %>

                                            <!-- Print -->
                                            <div class="relative inline-block">
                                                <button data-action="print" data-invoice-id="<%= invoice.id %>"
                                                    class="w-8 h-8 rounded-lg flex items-center justify-center text-purple-600 hover:bg-purple-100 hover:text-purple-700 transition-all"
                                                    title="Print">
                                                    <i class="fas fa-print"></i>
                                                </button>
                                                <!-- Print Menu Dropdown -->
                                                <div id="printMenu-<%= invoice.id %>"
                                                    class="hidden absolute right-0 mt-2 w-48 bg-white/90 backdrop-blur-xl rounded-xl shadow-xl border border-gray-100 z-50 overflow-hidden ring-1 ring-black/5">
                                                    <a href="/billing/tagihan/<%= invoice.id %>/print" target="_blank"
                                                        class="flex items-center px-4 py-3 text-sm text-gray-700 hover:bg-blue-50 hover:text-blue-700 transition-colors border-b border-gray-100">
                                                        <i class="fas fa-file-pdf mr-3 text-red-500"></i>Print A4
                                                    </a>
                                                    <a href="/billing/tagihan/<%= invoice.id %>/print-thermal"
                                                        target="_blank"
                                                        class="flex items-center px-4 py-3 text-sm text-gray-700 hover:bg-blue-50 hover:text-blue-700 transition-colors">
                                                        <i class="fas fa-receipt mr-3 text-gray-500"></i>Print Thermal
                                                    </a>
                                                </div>
                                            </div>

                                            <!-- Pay -->
                                            <% if (invoice.status !=='paid' && invoice.status !=='cancelled' ) { %>
                                                <button data-action="pay" data-invoice-id="<%= invoice.id %>"
                                                    class="w-8 h-8 rounded-lg flex items-center justify-center text-green-600 hover:bg-green-100 hover:text-green-700 transition-all"
                                                    title="Bayar">
                                                    <i class="fas fa-money-bill-wave"></i>
                                                </button>
                                                <% } %>

                                                    <!-- Isolate/Restore -->
                                                    <% if (invoice.status==='overdue' || invoice.customer_is_isolated) {
                                                        %>
                                                        <button data-action="restore"
                                                            data-customer-id="<%= invoice.customer_id %>"
                                                            data-customer-name="<%= invoice.customer_name %>"
                                                            class="w-8 h-8 rounded-lg flex items-center justify-center text-amber-600 hover:bg-amber-100 hover:text-amber-700 transition-all"
                                                            title="Unisolir">
                                                            <i class="fas fa-unlock"></i>
                                                        </button>
                                                        <% } else { %>
                                                            <button data-action="isolate"
                                                                data-customer-id="<%= invoice.customer_id %>"
                                                                data-customer-name="<%= invoice.customer_name %>"
                                                                class="w-8 h-8 rounded-lg flex items-center justify-center text-red-600 hover:bg-red-100 hover:text-red-700 transition-all"
                                                                title="Isolir">
                                                                <i class="fas fa-lock"></i>
                                                            </button>
                                                            <% } %>

                                                                <!-- Delete -->
                                                                <button data-action="delete"
                                                                    data-invoice-id="<%= invoice.id %>"
                                                                    data-invoice-number="<%= invoice.invoice_number %>"
                                                                    class="w-8 h-8 rounded-lg flex items-center justify-center text-gray-400 hover:bg-red-50 hover:text-red-600 transition-all"
                                                                    title="Hapus">
                                                                    <i class="fas fa-trash"></i>
                                                                </button>
                                </div>
                            </td>
                        </tr>
                        <% }); %>
                            <% } else { %>
                                <tr>
                                    <td colspan="9" class="px-6 py-16 text-center text-gray-400">
                                        <div class="flex flex-col items-center justify-center">
                                            <div
                                                class="w-16 h-16 bg-gray-50 rounded-full flex items-center justify-center mb-3 text-gray-300">
                                                <i class="fas fa-inbox text-3xl"></i>
                                            </div>
                                            <p class="font-medium text-gray-500">Tidak ada tagihan ditemukan</p>
                                            <p class="text-xs mt-1">Coba sesuaikan filter pencarian anda.</p>
                                        </div>
                                    </td>
                                </tr>
                                <% } %>
            </tbody>
        </table>
    </div>
</div>

<!-- Pagination -->
<!-- Pagination -->
<% if (pagination.totalPages> 1) { %>
    <div
        class="glass-panel px-4 py-4 flex items-center justify-between mt-6 rounded-xl shadow-lg border border-white/20">
        <div class="flex-1 flex justify-between sm:hidden">
            <% if (pagination.currentPage> 1) { %>
                <a href="?page=<%= pagination.currentPage - 1 %>"
                    class="relative inline-flex items-center px-4 py-2 border border-blue-200 text-sm font-medium rounded-lg text-blue-700 bg-white hover:bg-blue-50 transition-colors shadow-sm">
                    Sebelumnya
                </a>
                <% } %>
                    <% if (pagination.currentPage < pagination.totalPages) { %>
                        <a href="?page=<%= pagination.currentPage + 1 %>"
                            class="ml-3 relative inline-flex items-center px-4 py-2 border border-blue-200 text-sm font-medium rounded-lg text-blue-700 bg-white hover:bg-blue-50 transition-colors shadow-sm">
                            Selanjutnya
                        </a>
                        <% } %>
        </div>
        <div class="hidden sm:flex-1 sm:flex sm:items-center sm:justify-between">
            <div>
                <p class="text-sm text-gray-700 font-medium">
                    Menampilkan <span class="font-bold text-blue-700">
                        <%= ((pagination.currentPage - 1) * pagination.limit) + 1 %>
                    </span>
                    sampai <span class="font-bold text-blue-700">
                        <%= Math.min(pagination.currentPage * pagination.limit, pagination.totalCount) %>
                    </span>
                    dari <span class="font-bold text-blue-700">
                        <%= pagination.totalCount %>
                    </span> hasil
                </p>
            </div>
            <div>
                <nav class="relative z-0 inline-flex rounded-xl shadow-sm -space-x-px bg-white/50 backdrop-blur-sm"
                    aria-label="Pagination">
                    <% if (pagination.currentPage> 1) { %>
                        <a href="?page=<%= pagination.currentPage - 1 %>"
                            class="relative inline-flex items-center px-3 py-2 rounded-l-xl border border-gray-300 bg-white/60 text-sm font-medium text-gray-500 hover:bg-blue-50 hover:text-blue-600 transition-colors">
                            <i class="fas fa-chevron-left"></i>
                        </a>
                        <% } %>

                            <% for (let i=Math.max(1, pagination.currentPage - 2); i <=Math.min(pagination.totalPages,
                                pagination.currentPage + 2); i++) { %>
                                <% if (i===pagination.currentPage) { %>
                                    <span
                                        class="relative inline-flex items-center px-4 py-2 border border-blue-500 bg-blue-50 text-sm font-bold text-blue-600 z-10">
                                        <%= i %>
                                    </span>
                                    <% } else { %>
                                        <a href="?page=<%= i %>"
                                            class="relative inline-flex items-center px-4 py-2 border border-gray-300 bg-white/60 text-sm font-medium text-gray-700 hover:bg-blue-50 hover:text-blue-600 transition-colors">
                                            <%= i %>
                                        </a>
                                        <% } %>
                                            <% } %>

                                                <% if (pagination.currentPage < pagination.totalPages) { %>
                                                    <a href="?page=<%= pagination.currentPage + 1 %>"
                                                        class="relative inline-flex items-center px-3 py-2 rounded-r-xl border border-gray-300 bg-white/60 text-sm font-medium text-gray-500 hover:bg-blue-50 hover:text-blue-600 transition-colors">
                                                        <i class="fas fa-chevron-right"></i>
                                                    </a>
                                                    <% } %>
                </nav>
            </div>
        </div>
    </div>
    <% } %>

        <!-- Generate Invoice Modal -->
        <div id="generateInvoiceModal"
            style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background-color: rgba(0,0,0,0.5); z-index: 9999; align-items: center; justify-content: center;">
            <div
                style="background: white; border-radius: 12px; padding: 24px; max-width: 500px; width: 90%; box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1);">
                <!-- Header -->
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h3 style="font-size: 20px; font-weight: bold; color: #111827; margin: 0;">
                        <i class="fas fa-file-invoice" style="color: #16a34a; margin-right: 8px;"></i>Generate Tagihan
                    </h3>
                    <button id="btnCloseModal" data-action="close-modal"
                        style="background: none; border: none; font-size: 24px; cursor: pointer; color: #6b7280;">
                        &times;
                    </button>
                </div>

                <!-- Form -->
                <form id="generateInvoiceForm">
                    <!-- Period Selection -->
                    <div style="margin-bottom: 20px;">
                        <div>
                            <label
                                style="display: block; font-size: 14px; font-weight: 600; color: #374151; margin-bottom: 8px;">
                                Periode Tagihan:
                            </label>
                            <input type="month" id="invoicePeriod" required
                                style="width: 100%; padding: 10px 12px; border: 1px solid #d1d5db; border-radius: 8px; font-size: 14px;">
                            <p style="margin-top: 6px; font-size: 12px; color: #6b7280; font-style: italic;">
                                *Jatuh tempo akan diset otomatis sesuai pengaturan scheduler/otomasi.
                            </p>
                        </div>
                    </div>

                    <!-- Target Selection -->
                    <div style="margin-bottom: 16px;">
                        <label
                            style="display: block; font-size: 14px; font-weight: 600; color: #374151; margin-bottom: 8px;">Target:</label>
                        <div
                            style="display: flex; gap: 16px; background: #f3f4f6; padding: 4px; border-radius: 8px; display: inline-flex;">
                            <label
                                style="display: flex; align-items: center; cursor: pointer; padding: 6px 12px; border-radius: 6px;"
                                id="lblTargetAll" class="bg-white shadow-sm">
                                <input type="radio" name="targetType" value="all" checked
                                    onchange="toggleCustomerSelect('all')" style="margin-right: 6px;">
                                <span style="font-size: 14px;">Semua Pelanggan</span>
                            </label>
                            <label
                                style="display: flex; align-items: center; cursor: pointer; padding: 6px 12px; border-radius: 6px;"
                                id="lblTargetSelected">
                                <input type="radio" name="targetType" value="selected"
                                    onchange="toggleCustomerSelect('selected')" style="margin-right: 6px;">
                                <span style="font-size: 14px;">Pilih Manual</span>
                            </label>
                        </div>
                    </div>

                    <!-- Customer Selector -->
                    <div id="customerSelectorContainer"
                        style="display: none; border: 1px solid #d1d5db; border-radius: 8px; padding: 12px; margin-bottom: 16px; background: #f9fafb;">
                        <input type="text" id="customerSearch" placeholder="Cari nama pelanggan..."
                            onkeyup="filterCustomers()"
                            style="width: 100%; padding: 8px 12px; margin-bottom: 8px; border: 1px solid #e5e7eb; border-radius: 6px; font-size: 13px;">

                        <div
                            style="margin-bottom: 6px; display: flex; justify-content: space-between; align-items: center;">
                            <span style="font-size: 12px; color: #6b7280; font-weight: 600;">Daftar Pelanggan
                                Aktif</span>
                            <button type="button" onclick="selectAllCustomersFiltered()"
                                style="font-size: 11px; color: #2563eb; background: none; border: none; cursor: pointer;">Pilih
                                Tampil</button>
                        </div>

                        <div id="customerList"
                            style="max-height: 200px; overflow-y: auto; display: flex; flex-direction: column; gap: 1px; border: 1px solid #e5e7eb; background: white; border-radius: 6px;">
                            <% if (typeof activeCustomers !=='undefined' && activeCustomers) { %>
                                <% activeCustomers.forEach(c=> { %>
                                    <label class="customer-item"
                                        style="display: flex; align-items: center; cursor: pointer; padding: 8px; border-bottom: 1px solid #f3f4f6;">
                                        <input type="checkbox" name="customer_ids" value="<%= c.id %>"
                                            data-name="<%= c.name.toLowerCase() %> <%= (c.customer_code || '').toLowerCase() %>"
                                            onchange="updateSelectedCount()" style="margin-right: 10px;">
                                        <div style="flex: 1;">
                                            <div style="font-size: 13px; font-weight: 500; color: #1f2937;">
                                                <%= c.name %>
                                            </div>
                                            <div style="font-size: 11px; color: #6b7280;">
                                                <%= c.odc_name || 'No ODC' %> • <%= c.customer_code || '-' %>
                                            </div>
                                        </div>
                                    </label>
                                    <% }) %>
                                        <% } else { %>
                                            <div
                                                style="padding: 12px; text-align: center; color: #6b7280; font-size: 12px;">
                                                Data pelanggan tidak tersedia</div>
                                            <% } %>
                        </div>
                        <div style="margin-top: 8px; font-size: 12px; color: #6b7280; text-align: right;">
                            <span id="selectedCustomerCount">0</span> pelanggan dipilih
                        </div>
                    </div>

                    <!-- WhatsApp Option -->
                    <div style="margin-bottom: 20px;">
                        <label style="display: flex; align-items: center; cursor: pointer;">
                            <input type="checkbox" id="sendWhatsapp"
                                style="width: 18px; height: 18px; margin-right: 8px; cursor: pointer;">
                            <span style="font-size: 14px; color: #374151;">
                                <i class="fab fa-whatsapp" style="color: #25d366; margin-right: 4px;"></i>
                                Kirim notifikasi WhatsApp otomatis
                            </span>
                        </label>
                    </div>

                    <!-- Info Box -->
                    <div
                        style="background-color: #dbeafe; border-left: 4px solid #3b82f6; padding: 12px; border-radius: 6px; margin-bottom: 20px;">
                        <p style="font-size: 12px; color: #1e40af; margin: 0; line-height: 1.5;">
                            <i class="fas fa-info-circle" style="margin-right: 4px;"></i>
                            Fitur ini akan meng-generate tagihan untuk pelanggan yang <strong>belum memiliki
                                tagihan</strong> pada periode yang dipilih.
                        </p>
                    </div>

                    <!-- Buttons -->
                    <div style="display: flex; gap: 10px; justify-content: flex-end;">
                        <button type="button" id="btnCancelModal" data-action="cancel-modal"
                            style="padding: 10px 20px; border: 1px solid #d1d5db; background: white; color: #374151; border-radius: 8px; font-weight: 500; cursor: pointer;">
                            Batal
                        </button>
                        <button type="submit"
                            style="padding: 10px 20px; border: none; background: #16a34a; color: white; border-radius: 8px; font-weight: 500; cursor: pointer; display: inline-flex; align-items: center;">
                            <i class="fas fa-check" style="margin-right: 6px;"></i>
                            Generate
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Print ODC Modal with Search -->
        <div id="odcPrintModal"
            style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background-color: rgba(0,0,0,0.5); z-index: 9999; align-items: center; justify-content: center;">
            <div
                style="background: white; border-radius: 12px; padding: 24px; max-width: 600px; width: 90%; box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1); max-height: 80vh; display: flex; flex-direction: column;">
                <!-- Header -->
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h3 style="font-size: 20px; font-weight: bold; color: #111827; margin: 0;">
                        <i class="fas fa-print" style="color: #0891b2; margin-right: 8px;"></i>Print Tagihan Area ODC
                    </h3>
                    <button onclick="closeOdcPrintModal()"
                        style="background: none; border: none; font-size: 24px; cursor: pointer; color: #6b7280;">
                        &times;
                    </button>
                </div>

                <!-- Search Box -->
                <div style="margin-bottom: 16px;">
                    <div style="position: relative;">
                        <i class="fas fa-search"
                            style="position: absolute; left: 12px; top: 50%; transform: translateY(-50%); color: #9ca3af;"></i>
                        <input type="text" id="odcSearchInput" placeholder="Cari nama ODC atau lokasi..."
                            onkeyup="filterOdcList()"
                            style="width: 100%; padding: 10px 12px 10px 36px; border: 1px solid #d1d5db; border-radius: 8px; font-size: 14px;">
                    </div>
                </div>

                <!-- ODC List Container -->
                <div style="flex: 1; overflow-y: auto; border: 1px solid #e5e7eb; border-radius: 8px; padding: 8px;">
                    <% if (typeof odcList !=='undefined' && odcList && odcList.length> 0) { %>
                        <div id="odcListContainer" style="display: grid; gap: 8px;">
                            <% odcList.forEach(function(odc) { %>
                                <div class="odc-item" data-name="<%= odc.name.toLowerCase() %>"
                                    data-location="<%= (odc.location || '').toLowerCase() %>"
                                    style="display: flex; justify-content: space-between; align-items: center; padding: 12px; border: 1px solid #f3f4f6; border-radius: 6px;"
                                    class="hover:bg-gray-50">
                                    <div>
                                        <div style="font-weight: 600; color: #1f2937;">
                                            <%= odc.name %>
                                        </div>
                                        <div style="font-size: 12px; color: #6b7280; margin-top: 2px;">
                                            <i class="fas fa-map-pin" style="margin-right: 4px;"></i>
                                            <%= odc.location || 'Lokasi tidak tersedia' %>
                                        </div>
                                    </div>
                                    <a href="/billing/tagihan/print-odc/<%= odc.id %>?period=<%= filters.period || '' %>&format=thermal"
                                        target="_blank"
                                        style="display: inline-flex; align-items: center; background-color: #0891b2; color: white; padding: 6px 12px; border-radius: 6px; text-decoration: none; font-size: 13px; font-weight: 500;">
                                        <i class="fas fa-print" style="margin-right: 6px;"></i> Print
                                    </a>
                                </div>
                                <% }); %>
                        </div>
                        <div id="odcNoResults"
                            style="display: none; text-align: center; padding: 20px; color: #6b7280;">
                            <i class="fas fa-search" style="font-size: 24px; margin-bottom: 8px; color: #d1d5db;"></i>
                            <p>Tidak ada ODC yang cocok</p>
                        </div>
                        <% } else { %>
                            <div style="text-align: center; padding: 40px; color: #6b7280;">
                                <i class="fas fa-inbox"
                                    style="font-size: 32px; margin-bottom: 12px; color: #d1d5db;"></i>
                                <p>Belum ada data ODC</p>
                            </div>
                            <% } %>
                </div>

                <!-- Footer -->
                <div
                    style="margin-top: 16px; padding-top: 16px; border-top: 1px solid #e5e7eb; display: flex; justify-content: space-between; align-items: center;">
                    <span style="font-size: 12px; color: #6b7280;">
                        Total: <%= typeof odcList !=='undefined' ? odcList.length : 0 %> Area
                    </span>
                    <button onclick="closeOdcPrintModal()"
                        style="padding: 8px 16px; border: 1px solid #d1d5db; background: white; color: #374151; border-radius: 6px; font-weight: 500; cursor: pointer; font-size: 14px;">
                        Tutup
                    </button>
                </div>
            </div>
        </div>

        <script>
            // ODC Modal Functions
            function showOdcPrintModal() {
                const modal = document.getElementById('odcPrintModal');
                if (modal) {
                    modal.style.display = 'flex';
                    // Focus search input
                    setTimeout(() => document.getElementById('odcSearchInput').focus(), 100);
                }
            }

            function closeOdcPrintModal() {
                const modal = document.getElementById('odcPrintModal');
                if (modal) {
                    modal.style.display = 'none';
                }
            }

            function filterOdcList() {
                const input = document.getElementById('odcSearchInput');
                const filter = input.value.toLowerCase();
                const container = document.getElementById('odcListContainer');
                const items = container.getElementsByClassName('odc-item');
                let hasVisible = false;

                for (let i = 0; i < items.length; i++) {
                    const name = items[i].getAttribute('data-name');
                    const location = items[i].getAttribute('data-location');

                    if (name.includes(filter) || location.includes(filter)) {
                        items[i].style.display = "";
                        hasVisible = true;
                    } else {
                        items[i].style.display = "none";
                    }
                }

                // Show no results message
                const noResults = document.getElementById('odcNoResults');
                if (noResults) {
                    noResults.style.display = hasVisible ? "none" : "block";
                }
            }

            // Close modal when clicking outside
            document.addEventListener('click', function (e) {
                const modal = document.getElementById('odcPrintModal');
                if (e.target === modal) {
                    closeOdcPrintModal();
                }
            });

            // Prevent closing when clicking content
            document.getElementById('odcPrintModal')?.querySelector('div').addEventListener('click', function (e) {
                e.stopPropagation();
            });

            // Show Generate Invoice Modal (Existing function, just re-declaring to be safe if moved)
            function showGenerateInvoiceModal() {
                console.log('🟢 showGenerateInvoiceModal() called!');
                const modal = document.getElementById('generateInvoiceModal');
                console.log('Modal element:', modal);


                if (!modal) {
                    alert('❌ ERROR: Modal element not found! Please refresh the page.');
                    return;
                }

                const now = new Date();
                const currentMonth = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}`;

                // Set default to current month
                const periodInput = document.getElementById('invoicePeriod');
                if (periodInput) {
                    periodInput.value = currentMonth;
                    console.log('✅ Period set to:', currentMonth);
                }

                // Show modal
                modal.style.display = 'flex';
                console.log('✅ Modal displayed');

                // Check for existing invoices for the default period
                checkExistingInvoices();
            }

            // Close Generate Invoice Modal
            function closeGenerateInvoiceModal() {
                const modal = document.getElementById('generateInvoiceModal');
                modal.style.display = 'none';
            }

            // --- Dynamic Customer Filtering Logic ---
            let existingInvoicesCustomerIds = [];

            async function checkExistingInvoices() {
                const period = document.getElementById('invoicePeriod').value;
                if (!period) return;

                const listContainer = document.getElementById('customerList');
                // Optional: show loading state in list

                try {
                    const response = await fetch(`/billing/tagihan/check-duplicates?period=${period}`);
                    const data = await response.json();

                    if (data.success) {
                        existingInvoicesCustomerIds = data.customerIds;
                        updateCustomerListVisibility();
                    }
                } catch (error) {
                    console.error('Error checking existing invoices:', error);
                }
            }

            function updateCustomerListVisibility() {
                const container = document.getElementById('customerList');
                if (!container) return;

                const items = container.querySelectorAll('.customer-item');
                const searchInput = document.getElementById('customerSearch');
                const searchFilter = searchInput ? searchInput.value.toLowerCase() : "";

                items.forEach(item => {
                    const cb = item.querySelector('input');
                    if (!cb) return;

                    const customerId = parseInt(cb.value);
                    const name = cb.getAttribute('data-name');

                    // Hide if already has invoice for this period
                    const alreadyHasInvoice = existingInvoicesCustomerIds.includes(customerId);

                    if (alreadyHasInvoice) {
                        item.style.display = 'none';
                        item.classList.add('already-generated');
                        cb.checked = false; // Uncheck if it was checked
                    } else if (name.includes(searchFilter)) {
                        item.style.display = 'flex';
                        item.classList.remove('already-generated');
                    } else {
                        item.style.display = 'none';
                        item.classList.remove('already-generated');
                    }
                });

                updateSelectedCount();
            }

            // Handle form submission and button clicks
            document.addEventListener('DOMContentLoaded', function () {
                console.log('🚀 Page loaded, initializing handlers...');

                // Generate Tagihan button
                const btnGenerate = document.getElementById('btnGenerateTagihan');
                if (btnGenerate) {
                    console.log('✅ Generate button found');
                    btnGenerate.addEventListener('click', function () {
                        console.log('🟢 Generate button clicked!');
                        showGenerateInvoiceModal();
                    });
                }

                // Print ODC button
                const btnPrintODC = document.getElementById('btnPrintODC');
                if (btnPrintODC) {
                    btnPrintODC.addEventListener('click', function (e) {
                        toggleOdcPrintMenu(e);
                    });
                }

                // Bulk Delete button
                const btnBulkDelete = document.getElementById('bulkDeleteBtn');
                if (btnBulkDelete) {
                    btnBulkDelete.addEventListener('click', function () {
                        bulkDeleteInvoices();
                    });
                }

                // Bulk Reminder button
                const btnBulkReminder = document.getElementById('btnBulkReminder');
                if (btnBulkReminder) {
                    btnBulkReminder.addEventListener('click', function () {
                        bulkSendReminder();
                    });
                }

                // Export PDF button
                const btnExportPDF = document.getElementById('btnExportPDF');
                if (btnExportPDF) {
                    btnExportPDF.addEventListener('click', function () {
                        exportPDF();
                    });
                }

                // Print Selected button
                const btnPrintSelected = document.getElementById('btnPrintSelected');
                if (btnPrintSelected) {
                    btnPrintSelected.addEventListener('click', function () {
                        printSelectedInvoices();
                    });
                }

                // Print All button
                const btnPrintAll = document.getElementById('btnPrintAll');
                if (btnPrintAll) {
                    btnPrintAll.addEventListener('click', function () {
                        printAllInvoices();
                    });
                }

                // Modal close buttons
                const btnCloseModal = document.getElementById('btnCloseModal');
                const btnCancelModal = document.getElementById('btnCancelModal');
                if (btnCloseModal) {
                    btnCloseModal.addEventListener('click', closeGenerateInvoiceModal);
                }
                if (btnCancelModal) {
                    btnCancelModal.addEventListener('click', closeGenerateInvoiceModal);
                }

                // Listen for period change
                const periodInput = document.getElementById('invoicePeriod');
                if (periodInput) {
                    periodInput.addEventListener('change', checkExistingInvoices);
                }

                // Form submission
                const form = document.getElementById('generateInvoiceForm');
                if (form) {
                    console.log('✅ Form found');
                    form.addEventListener('submit', function (e) {
                        e.preventDefault();
                        console.log('📝 Form submitted');
                        generateInvoicesFromForm();
                    });
                }

                // Close modal when clicking outside
                const modal = document.getElementById('generateInvoiceModal');
                if (modal) {
                    console.log('✅ Modal found');
                    modal.addEventListener('click', function (e) {
                        if (e.target === modal) {
                            closeGenerateInvoiceModal();
                        }
                    });
                }

                // Select All checkbox
                const selectAllCheckbox = document.getElementById('selectAll');
                if (selectAllCheckbox) {
                    console.log('✅ Select All checkbox found');
                    selectAllCheckbox.addEventListener('change', toggleSelectAll);
                }

                // Invoice checkboxes
                const invoiceCheckboxes = document.querySelectorAll('.invoice-checkbox');
                console.log(`✅ Found ${invoiceCheckboxes.length} invoice checkboxes`);
                invoiceCheckboxes.forEach(function (checkbox) {
                    checkbox.addEventListener('change', updateBulkDeleteButton);
                });

                // Event delegation for table action buttons
                document.addEventListener('click', function (e) {
                    const button = e.target.closest('button[data-action]');
                    if (!button) return;

                    const action = button.dataset.action;
                    console.log('🎯 Action button clicked:', action);

                    switch (action) {
                        case 'detail':
                            showInvoiceDetail(button.dataset.invoiceId);
                            break;
                        case 'promise':
                            openJanjiBayarModal(button.dataset.invoiceId, button.dataset.invoiceDate);
                            break;
                        case 'print':
                            togglePrintMenu(e, button.dataset.invoiceId);
                            break;
                        case 'pay':
                            showPaymentForm(button.dataset.invoiceId);
                            break;
                        case 'isolate':
                            isolateCustomer(button.dataset.customerId, button.dataset.customerName);
                            break;
                        case 'restore':
                            restoreCustomer(button.dataset.customerId, button.dataset.customerName);
                            break;
                        case 'delete':
                            deleteInvoice(button.dataset.invoiceId, button.dataset.invoiceNumber);
                            break;
                    }
                });

                console.log('✅ All handlers initialized including table actions');
            });

            // View Helpers for Customer Selection (Manual Billing)
            function toggleCustomerSelect(mode) {
                const container = document.getElementById('customerSelectorContainer');
                const lblAll = document.getElementById('lblTargetAll');
                const lblSel = document.getElementById('lblTargetSelected');

                if (mode === 'selected') {
                    container.style.display = 'block';
                    if (lblSel) lblSel.classList.add('bg-white', 'shadow-sm');
                    if (lblAll) lblAll.classList.remove('bg-white', 'shadow-sm');
                } else {
                    container.style.display = 'none';
                    if (lblAll) lblAll.classList.add('bg-white', 'shadow-sm');
                    if (lblSel) lblSel.classList.remove('bg-white', 'shadow-sm');
                }
            }

            function filterCustomers() {
                updateCustomerListVisibility();
            }

            function updateSelectedCount() {
                const cbs = document.querySelectorAll('input[name="customer_ids"]:checked');
                const countSpan = document.getElementById('selectedCustomerCount');
                if (countSpan) countSpan.innerText = cbs.length;
            }

            function selectAllCustomersFiltered() {
                // Select only visible customers
                const container = document.getElementById('customerList');
                const items = container.querySelectorAll('.customer-item');
                let changed = false;

                items.forEach(item => {
                    if (item.style.display !== 'none') {
                        const cb = item.querySelector('input');
                        if (!cb.checked) {
                            cb.checked = true;
                            changed = true;
                        }
                    }
                });

                if (changed) updateSelectedCount();
            }

            // Generate invoices from form data
            function generateInvoicesFromForm() {
                const period = document.getElementById('invoicePeriod').value;
                const sendWhatsapp = document.getElementById('sendWhatsapp').checked;

                // Using null/undefined for offset to signal backend to use default/scheduler settings
                const dueDateOffset = null;

                // Determine target
                let customerIds = [];
                let targetType = 'all';
                const targetRadio = document.querySelector('input[name="targetType"]:checked');
                if (targetRadio) targetType = targetRadio.value;

                if (targetType === 'selected') {
                    const cbs = document.querySelectorAll('input[name="customer_ids"]:checked');
                    cbs.forEach(cb => customerIds.push(cb.value));

                    if (customerIds.length === 0) {
                        alert('❌ Harap pilih minimal 1 pelanggan atau pilih opsi "Semua Pelanggan".');
                        return;
                    }
                }

                if (!period) {
                    alert('❌ Pilih periode tagihan terlebih dahulu');
                    return;
                }

                // Parse period
                const [year, month] = period.split('-');
                const monthNames = ['Januari', 'Februari', 'Maret', 'April', 'Mei', 'Juni',
                    'Juli', 'Agustus', 'September', 'Oktober', 'November', 'Desember'];
                const monthName = monthNames[parseInt(month) - 1];

                const targetDesc = targetType === 'all' ? 'Semua Pelanggan Aktif' : `${customerIds.length} Pelanggan Tertentu`;

                const confirmMsg = `📋 GENERATE TAGIHAN MANUAL
                
📅 Periode: ${monthName} ${year}
👥 Target: ${targetDesc}
📱 WhatsApp: ${sendWhatsapp ? 'Ya' : 'Tidak'}

Lanjutkan proses generate?`;

                if (!confirm(confirmMsg)) {
                    return;
                }

                // Close modal
                closeGenerateInvoiceModal();

                // Send request
                fetch('/billing/tagihan/generate-bulk', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        period: period,
                        due_date_offset: dueDateOffset,
                        send_whatsapp: sendWhatsapp,
                        customer_ids: targetType === 'selected' ? customerIds : null
                    })
                })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            let msg = `✅ SELESAI!\n\n`;
                            msg += `📊 Periode: ${monthName} ${year}\n`;
                            msg += `✓ Dibuat: ${data.created_count}\n`;

                            if (data.created_count === 0 && data.diagnostics) {
                                msg += `\n⚠️ DIAGNOSTIK:\n`;
                                msg += `- Total Pelanggan: ${data.diagnostics.total_customers}\n`;
                                msg += `- Pelanggan Aktif: ${data.diagnostics.active_customers}\n`;
                                msg += `- Ditemukan Query: ${data.diagnostics.query_result_length}\n`;
                                if (data.diagnostics.active_customers === 0) {
                                    msg += `\n💡 SARAN: Pastikan status pelanggan adalah 'active' (bukan inactive/suspended)`;
                                }
                                if (data.diagnostics.trace && data.diagnostics.trace.length > 0) {
                                    msg += `\n🔍 TRACE (5 Pelanggan Pertama):\n`;
                                    data.diagnostics.trace.forEach(t => msg += `- ${t}\n`);
                                }
                            }

                            if (data.skipped_count > 0) {
                                msg += `⚠️ Dilewati: ${data.skipped_count}\n`;
                                if (data.skipped_details && data.skipped_details.length > 0) {
                                    msg += `\nDetail yang dilewati (Duplikat/Konflik):\n`;
                                    data.skipped_details.slice(0, 5).forEach(skip => {
                                        msg += `- ${skip.name}: ${skip.reason}\n`;
                                    });
                                    if (data.skipped_details.length > 5) msg += `- ...dan ${data.skipped_details.length - 5} lainnya\n`;
                                }
                            }

                            if (data.errors && data.errors.length > 0) {
                                msg += `\n❌ ERROR (${data.errors.length}):\n`;
                                data.errors.slice(0, 5).forEach(err => msg += `- ${err}\n`);
                            }

                            alert(msg + '\nHalaman akan di-refresh...');
                            location.reload();
                        } else {
                            alert('❌ GAGAL!\n\n' + (data.message || 'Terjadi kesalahan'));
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        alert('❌ TERJADI KESALAHAN!\n\n' + error.message);
                    });
            }

            // Toggle select all checkboxes
            function toggleSelectAll() {
                const selectAll = document.getElementById('selectAll');
                const checkboxes = document.querySelectorAll('.invoice-checkbox');
                checkboxes.forEach(cb => cb.checked = selectAll.checked);
                updateBulkDeleteButton();
            }

            // Update bulk delete and print selected button visibility
            function updateBulkDeleteButton() {
                const checkboxes = document.querySelectorAll('.invoice-checkbox:checked');
                const bulkDeleteBtn = document.getElementById('bulkDeleteBtn');
                const selectedCount = document.getElementById('selectedCount');

                const btnBulkReminder = document.getElementById('btnBulkReminder');
                const selectedReminderCount = document.getElementById('selectedReminderCount');

                const btnPrintSelected = document.getElementById('btnPrintSelected');
                const selectedPrintCount = document.getElementById('selectedPrintCount');

                const hasSelected = checkboxes.length > 0;

                if (hasSelected) {
                    // Update Delete Button
                    if (bulkDeleteBtn) {
                        bulkDeleteBtn.classList.remove('bulk-delete-hidden');
                        bulkDeleteBtn.classList.add('bulk-delete-visible');
                    }
                    if (selectedCount) selectedCount.textContent = checkboxes.length;

                    // Update Print Selected Button
                    if (btnPrintSelected) {
                        btnPrintSelected.classList.remove('bulk-delete-hidden');
                        btnPrintSelected.classList.add('bulk-delete-visible');
                    }
                    if (selectedPrintCount) selectedPrintCount.textContent = checkboxes.length;

                    // Update Bulk Reminder Button
                    if (btnBulkReminder) {
                        btnBulkReminder.classList.remove('bulk-delete-hidden');
                        btnBulkReminder.classList.add('bulk-delete-visible');
                    }
                    if (selectedReminderCount) selectedReminderCount.textContent = checkboxes.length;

                } else {
                    // Hide Delete Button
                    if (bulkDeleteBtn) {
                        bulkDeleteBtn.classList.remove('bulk-delete-visible');
                        bulkDeleteBtn.classList.add('bulk-delete-hidden');
                    }

                    // Hide Print Selected Button
                    if (btnPrintSelected) {
                        btnPrintSelected.classList.remove('bulk-delete-visible');
                        btnPrintSelected.classList.add('bulk-delete-hidden');
                    }

                    // Hide Bulk Reminder Button
                    if (btnBulkReminder) {
                        btnBulkReminder.classList.remove('bulk-delete-visible');
                        btnBulkReminder.classList.add('bulk-delete-hidden');
                    }
                }
            }

            // Print selected invoices
            function printSelectedInvoices() {
                const checkboxes = document.querySelectorAll('.invoice-checkbox:checked');
                const invoiceIds = Array.from(checkboxes).map(cb => cb.value);

                if (invoiceIds.length === 0) {
                    alert('Pilih minimal 1 tagihan untuk diprint');
                    return;
                }

                // Create a form or URL with IDs
                const url = new URL('/billing/tagihan/print-all', window.location.origin);
                invoiceIds.forEach(id => url.searchParams.append('ids[]', id));

                window.open(url.toString(), '_blank');
            }

            // Bulk delete invoices
            function bulkDeleteInvoices() {
                console.log('🗑️ Bulk delete function called');
                const checkboxes = document.querySelectorAll('.invoice-checkbox:checked');
                const invoiceIds = Array.from(checkboxes).map(cb => cb.value);
                console.log('Selected invoices:', invoiceIds);

                if (invoiceIds.length === 0) {
                    alert('Pilih minimal 1 tagihan untuk dihapus');
                    return;
                }

                if (confirm(`⚠️ PERHATIAN: Hapus ${invoiceIds.length} tagihan terpilih?

- Semua data pembayaran terkait juga akan dihapus
- Tindakan ini tidak dapat dibatalkan`)) {
                    fetch('/billing/tagihan/bulk-delete', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ invoiceIds: invoiceIds })
                    })
                        .then(response => response.json())
                        .then(data => {
                            if (data.success) {
                                alert(`✅ Berhasil menghapus ${data.deleted} tagihan\n❌ Gagal: ${data.failed}`);
                                location.reload();
                            } else {
                                alert('❌ ' + data.message);
                            }
                        })
                        .catch(error => {
                            console.error('Error:', error);
                            alert('❌ Terjadi kesalahan saat menghapus tagihan');
                        });
                }
            }

            // Bulk send reminder
            function bulkSendReminder() {
                const checkboxes = document.querySelectorAll('.invoice-checkbox:checked');
                const invoiceIds = Array.from(checkboxes).map(cb => cb.value);

                if (invoiceIds.length === 0) {
                    alert('Pilih minimal 1 tagihan untuk diingatkan');
                    return;
                }

                if (confirm(`⚠️ Kirim pengingat WhatsApp ke ${invoiceIds.length} pelanggan terpilih?`)) {
                    // Show loading state
                    const btn = document.getElementById('btnBulkReminder');
                    const originalText = btn ? btn.innerHTML : '';
                    if (btn) {
                        btn.disabled = true;
                        btn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Mengirim...';
                    }

                    fetch('/billing/tagihan/bulk-reminder', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ invoiceIds: invoiceIds })
                    })
                        .then(response => response.json())
                        .then(data => {
                            if (data.success) {
                                alert(`✅ ${data.message}`);
                                // Uncheck all
                                document.getElementById('selectAll').checked = false;
                                checkboxes.forEach(cb => cb.checked = false);
                                updateBulkDeleteButton();
                            } else {
                                alert('❌ ' + data.message);
                            }
                        })
                        .catch(error => {
                            console.error('Error:', error);
                            alert('❌ Terjadi kesalahan saat mengirim pengingat');
                        })
                        .finally(() => {
                            if (btn) {
                                btn.disabled = false;
                                btn.innerHTML = originalText;
                            }
                        });
                }
            }

            // Toggle print menu
            function togglePrintMenu(event, invoiceId) {
                event.stopPropagation();
                const menu = document.getElementById(`printMenu-${invoiceId}`);

                // Close all other menus
                document.querySelectorAll('[id^="printMenu-"]').forEach(m => {
                    if (m.id !== `printMenu-${invoiceId}`) m.classList.add('hidden');
                });

                menu.classList.toggle('hidden');
            }

            // Close print menus when clicking outside
            document.addEventListener('click', function (event) {
                // Close invoice print menus
                document.querySelectorAll('[id^="printMenu-"]').forEach(m => m.classList.add('hidden'));

                // Close ODC print menu if click is outside
                const odcMenu = document.getElementById('odcPrintMenu');
                const odcButton = event.target.closest('#btnPrintODC');
                if (odcMenu && !odcButton && !odcMenu.contains(event.target)) {
                    odcMenu.classList.add('hidden');
                }
            });

            // Toggle ODC print menu
            function toggleOdcPrintMenu(event) {
                if (event) event.stopPropagation();
                const menu = document.getElementById('odcPrintMenu');
                if (menu) {
                    menu.classList.toggle('hidden');
                }
            }


            // Show invoice detail modal
            function showInvoiceDetail(invoiceId) {
                window.location.href = `/billing/tagihan/${invoiceId}`;
            }

            // Show payment form
            function showPaymentForm(invoiceId) {
                window.location.href = `/billing/tagihan/${invoiceId}/pay`;
            }

            // Isolate customer
            function isolateCustomer(customerId, customerName) {
                if (confirm(`Apakah Anda yakin ingin mengisolir pelanggan ${customerName}?\n\nIni akan memblokir akses internet pelanggan di MikroTik.`)) {
                    const reason = prompt('Alasan isolasi:', 'Belum bayar tagihan');
                    if (!reason) return;

                    fetch('/billing/customer/isolate', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            customerId: customerId,
                            reason: reason
                        })
                    })
                        .then(response => response.json())
                        .then(data => {
                            if (data.success) {
                                alert('✅ Pelanggan berhasil diisolir');
                                location.reload();
                            } else {
                                alert('❌ Gagal mengisolir: ' + data.message);
                            }
                        })
                        .catch(error => {
                            console.error('Error:', error);
                            alert('❌ Terjadi kesalahan saat mengisolir pelanggan');
                        });
                }
            }

            // Restore customer
            function restoreCustomer(customerId, customerName) {
                if (confirm(`Apakah Anda yakin ingin memulihkan akses pelanggan ${customerName}?\n\nIni akan mengaktifkan kembali akses internet pelanggan.`)) {
                    const reason = prompt('Alasan restore:', 'Sudah bayar tagihan');
                    if (!reason) return;

                    fetch('/billing/customer/restore', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            customerId: customerId,
                            reason: reason
                        })
                    })
                        .then(response => response.json())
                        .then(data => {
                            if (data.success) {
                                alert('✅ Pelanggan berhasil dipulihkan');
                                location.reload();
                            } else {
                                alert('❌ Gagal memulihkan: ' + data.message);
                            }
                        })
                        .catch(error => {
                            console.error('Error:', error);
                            alert('❌ Terjadi kesalahan saat memulihkan pelanggan');
                        });
                }
            }

            // Delete invoice
            function deleteInvoice(invoiceId, invoiceNumber) {
                if (confirm(`Apakah Anda yakin ingin menghapus tagihan ${invoiceNumber}?

⚠️ PERHATIAN:
- Data pembayaran terkait juga akan dihapus
- Tindakan ini tidak dapat dibatalkan`)) {
                    fetch(`/billing/tagihan/${invoiceId}`, {
                        method: 'DELETE',
                        headers: {
                            'Content-Type': 'application/json',
                        }
                    })
                        .then(response => response.json())
                        .then(data => {
                            if (data.success) {
                                alert('✅ ' + data.message);
                                location.reload();
                            } else {
                                alert('❌ Gagal menghapus: ' + data.message);
                            }
                        })
                        .catch(error => {
                            console.error('Error:', error);
                            alert('❌ Terjadi kesalahan saat menghapus tagihan');
                        });
                }
            }

            // Update invoice status (legacy function, kept for compatibility)
            function updateStatus(invoiceId, status) {
                if (confirm('Apakah Anda yakin ingin mengubah status tagihan ini?')) {
                    fetch(`/billing/tagihan/${invoiceId}/status`, {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ status: status })
                    })
                        .then(response => response.json())
                        .then(data => {
                            if (data.success) {
                                location.reload();
                            } else {
                                alert('Gagal mengubah status: ' + data.message);
                            }
                        })
                        .catch(error => {
                            console.error('Error:', error);
                            alert('Terjadi kesalahan saat mengubah status');
                        });
                }
            }

            // Export invoices to PDF
            function exportPDF() {
                const params = new URLSearchParams(window.location.search);
                window.open('/billing/tagihan/export/pdf?' + params.toString(), '_blank');
            }

            // Print all invoices
            function printAllInvoices() {
                const params = new URLSearchParams(window.location.search);
                window.open('/billing/tagihan/print-all?' + params.toString(), '_blank');
            }


            // Billing Action Manager
            (function () {
                // --- MODAL FUNCTIONS ---
                window.showOdcPrintModal = function () {
                    // (Assuming this is defined elsewhere or needed as a global)
                    const modal = document.getElementById('odcPrintModal');
                    if (modal) modal.style.display = 'block';
                };

                window.openJanjiBayarModal = function (id, currentDueDate) {
                    const idInput = document.getElementById('janjiBayarInvoiceId');
                    const dateInput = document.getElementById('janjiBayarDate');
                    if (!idInput || !dateInput) return;

                    idInput.value = id;
                    let dateStr = '';
                    if (currentDueDate) {
                        const date = new Date(currentDueDate);
                        if (!isNaN(date)) dateStr = date.toISOString().split('T')[0];
                    }
                    dateInput.value = dateStr;
                    document.getElementById('janjiBayarModal').style.display = 'block';
                };

                window.closeJanjiBayarModal = function () {
                    const modal = document.getElementById('janjiBayarModal');
                    if (modal) modal.style.display = 'none';
                };

                window.saveJanjiBayar = function () {
                    const id = document.getElementById('janjiBayarInvoiceId').value;
                    const date = document.getElementById('janjiBayarDate').value;

                    if (!date) {
                        Swal.fire('Peringatan', 'Pilih tanggal terlebih dahulu!', 'warning');
                        return;
                    }

                    const selectedDate = new Date(date);
                    const today = new Date();
                    today.setHours(0, 0, 0, 0);

                    if (selectedDate < today) {
                        Swal.fire('Gagal', 'Tanggal janji bayar harus hari ini atau yang akan datang!', 'error');
                        return;
                    }

                    Swal.fire({
                        title: 'Konfirmasi Janji Bayar',
                        text: `Ubah jatuh tempo ke ${selectedDate.toLocaleDateString('id-ID', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}? Pelanggan akan menerima notifikasi WA.`,
                        icon: 'question',
                        showCancelButton: true,
                        confirmButtonText: 'Ya, Simpan',
                        cancelButtonText: 'Batal'
                    }).then((res) => {
                        if (res.isConfirmed) {
                            const btn = document.querySelector('button[onclick="saveJanjiBayar()"]');
                            const originalText = btn.innerHTML;
                            btn.disabled = true;
                            btn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Menyimpan...';

                            fetch(`/billing/tagihan/${id}/due-date`, {
                                method: 'POST',
                                headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify({ due_date: date })
                            })
                                .then(r => r.json())
                                .then(d => {
                                    if (d.success) {
                                        Swal.fire('Berhasil', 'Janji bayar disimpan.', 'success').then(() => location.reload());
                                    } else {
                                        Swal.fire('Gagal', d.message, 'error');
                                        btn.disabled = false;
                                        btn.innerHTML = originalText;
                                    }
                                })
                                .catch(() => {
                                    Swal.fire('Error', 'Kesalahan sistem.', 'error');
                                    btn.disabled = false;
                                    btn.innerHTML = originalText;
                                });
                        }
                    });
                };

                // --- ACTION HANDLERS ---
                function sendInvoiceWA(id, btn) {
                    Swal.fire({
                        title: 'Kirim WhatsApp?',
                        text: "Kirim tagihan ini langsung ke WhatsApp pelanggan?",
                        icon: 'question',
                        showCancelButton: true,
                        confirmButtonText: 'Ya, Kirim Sekarang',
                        cancelButtonText: 'Batal',
                        confirmButtonColor: '#10b981'
                    }).then((result) => {
                        if (result.isConfirmed) {
                            const originalInner = btn.innerHTML;
                            btn.disabled = true;
                            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';

                            fetch(`/billing/tagihan/${id}/send-whatsapp`, {
                                method: 'POST',
                                headers: { 'Content-Type': 'application/json' }
                            })
                                .then(r => r.json())
                                .then(d => {
                                    if (d.success) {
                                        Swal.fire({ icon: 'success', title: 'Terkirim', text: d.message, toast: true, position: 'top-end', timer: 3000, showConfirmButton: false });
                                    } else {
                                        Swal.fire({ icon: 'error', title: 'Gagal', text: d.message });
                                    }
                                    btn.disabled = false;
                                    btn.innerHTML = originalInner;
                                })
                                .catch(e => {
                                    Swal.fire({ icon: 'error', title: 'Sistem Error', text: 'Terjadi kegagalan koneksi.' });
                                    btn.disabled = false;
                                    btn.innerHTML = originalInner;
                                });
                        }
                    });
                }

                function processBulkWA(ids) {
                    const btn = document.getElementById('btnBulkSendWA');
                    btn.disabled = true;
                    const originalText = btn.innerHTML;
                    btn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Mengantre...';

                    fetch('/billing/tagihan/bulk-send-whatsapp', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ invoice_ids: ids })
                    })
                        .then(r => r.json())
                        .then(d => {
                            Swal.fire('Berhasil', d.message, 'success').then(() => location.reload());
                        })
                        .catch(e => {
                            Swal.fire('Error', 'Gagal mengirim WhatsApp masal', 'error');
                            btn.disabled = false;
                            btn.innerHTML = originalText;
                        });
                }

                function updateBulkWAStats() {
                    const count = document.querySelectorAll('.invoice-checkbox:checked').length;
                    const span = document.getElementById('selectedSendWACount');
                    if (span) span.textContent = count;

                    // Toggle visibility of bulk delete and other bulk actions
                    const bulkItems = document.querySelectorAll('.bulk-delete-hidden');
                    if (count > 0) {
                        bulkItems.forEach(el => el.classList.add('bulk-delete-visible'));
                    } else {
                        bulkItems.forEach(el => el.classList.remove('bulk-delete-visible'));
                    }
                }

                // --- EVENT LISTENERS ---
                document.addEventListener('click', function (e) {
                    const btn = e.target.closest('[data-action]');
                    if (!btn) return;

                    const action = btn.dataset.action;
                    const id = btn.dataset.invoiceId;

                    switch (action) {
                        case 'send-wanew':
                            sendInvoiceWA(id, btn);
                            break;
                        case 'promise':
                            openJanjiBayarModal(id, btn.dataset.invoiceDate);
                            break;
                        case 'export-pdf':
                            // Handle export PDF (assuming there's a specific logic or it's a link)
                            window.location.href = `/billing/tagihan/export-pdf?ids=` +
                                Array.from(document.querySelectorAll('.invoice-checkbox:checked')).map(cb => cb.value).join(',');
                            break;
                    }
                });

                const btnBulkSendWA = document.getElementById('btnBulkSendWA');
                if (btnBulkSendWA) {
                    btnBulkSendWA.addEventListener('click', function () {
                        const selected = Array.from(document.querySelectorAll('.invoice-checkbox:checked')).map(cb => cb.value);

                        if (selected.length === 0) {
                            Swal.fire({
                                title: 'Kirim Semua?',
                                text: 'Kirim SEMUA tagihan yang tampil di halaman ini ke antrian WhatsApp?',
                                icon: 'warning',
                                showCancelButton: true,
                                confirmButtonText: 'Ya, Antrekan Semua',
                                cancelButtonText: 'Batal'
                            }).then((res) => {
                                if (res.isConfirmed) {
                                    const allShown = Array.from(document.querySelectorAll('.invoice-checkbox')).map(cb => cb.value);
                                    if (allShown.length === 0) {
                                        Swal.fire('Error', 'Tidak ada tagihan untuk dikirim.', 'error');
                                        return;
                                    }
                                    processBulkWA(allShown);
                                }
                            });
                        } else {
                            Swal.fire({
                                title: 'Kirim Masal',
                                text: `Kirim ${selected.length} tagihan terpilih ke antrian WhatsApp?`,
                                icon: 'question',
                                showCancelButton: true,
                                confirmButtonText: 'Ya, Antrekan',
                                cancelButtonText: 'Batal'
                            }).then((res) => {
                                if (res.isConfirmed) processBulkWA(selected);
                            });
                        }
                    });
                }

                document.addEventListener('change', function (e) {
                    if (e.target.classList.contains('invoice-checkbox') || e.target.id === 'selectAll') {
                        setTimeout(updateBulkWAStats, 50);
                    }
                });

                // Initial stat check
                updateBulkWAStats();
            })();
        </script>

        <!-- Janji Bayar Modal -->
        <div id="janjiBayarModal" style="display: none;"
            class="fixed inset-0 bg-black bg-opacity-50 overflow-y-auto h-full w-full" style="z-index: 9999;">
            <div class="relative top-20 mx-auto p-6 border w-full max-w-md shadow-2xl rounded-2xl bg-white">
                <!-- Header -->
                <div class="text-center">
                    <div
                        class="mx-auto flex items-center justify-center h-16 w-16 rounded-full bg-gradient-to-br from-indigo-500 to-purple-600 shadow-lg mb-4">
                        <i class="fas fa-calendar-check text-white text-2xl"></i>
                    </div>
                    <h3 class="text-2xl font-bold text-gray-900 mb-2">Janji Bayar</h3>
                    <p class="text-sm text-gray-600 mb-6 px-4">
                        Ubah tanggal jatuh tempo invoice. Sistem tidak akan melakukan isolir sebelum tanggal yang
                        ditentukan.
                    </p>
                </div>

                <!-- Form -->
                <div class="space-y-4">
                    <input type="hidden" id="janjiBayarInvoiceId">

                    <div>
                        <label for="janjiBayarDate" class="block text-sm font-semibold text-gray-700 mb-2">
                            <i class="fas fa-calendar text-indigo-600 mr-2"></i>Tanggal Janji Bayar
                        </label>
                        <input type="date" id="janjiBayarDate" required
                            class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all text-lg">
                    </div>

                    <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 rounded-r-lg">
                        <div class="flex">
                            <div class="flex-shrink-0">
                                <i class="fas fa-info-circle text-yellow-600"></i>
                            </div>
                            <div class="ml-3">
                                <p class="text-sm text-yellow-800">
                                    <strong>Catatan:</strong> Pelanggan akan menerima notifikasi WhatsApp tentang
                                    perpanjangan jatuh tempo ini.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Buttons -->
                <div class="mt-6 space-y-3">
                    <button type="button" onclick="saveJanjiBayar()"
                        class="w-full px-6 py-3.5 bg-gradient-to-r from-indigo-600 to-purple-600 text-white text-base font-semibold rounded-xl shadow-lg hover:shadow-xl hover:from-indigo-700 hover:to-purple-700 focus:outline-none focus:ring-4 focus:ring-indigo-300 transition-all transform hover:-translate-y-0.5">
                        <i class="fas fa-save mr-2"></i>Simpan Janji Bayar
                    </button>
                    <button type="button" onclick="closeJanjiBayarModal()"
                        class="w-full px-6 py-3 bg-gray-200 text-gray-700 text-base font-medium rounded-xl hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-400 transition-all">
                        <i class="fas fa-times mr-2"></i>Batal
                    </button>
                </div>
            </div>
        </div>