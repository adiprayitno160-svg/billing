<div class="rounded border border-slate-200 bg-white p-4">
    <div class="flex items-center justify-between mb-4">
        <h2 class="text-lg font-semibold">Daftar Paket PPPoE</h2>
        <a href="/packages/pppoe/packages/create" class="px-3 py-1.5 rounded bg-blue-600 text-white text-sm hover:bg-blue-700 inline-block">
            Tambah Paket
        </a>
    </div>
    
    <% if (success && success.length > 0) { %>
    <div class="mb-4 p-3 bg-green-100 border border-green-300 text-green-700 rounded">
        <%= success[0] %>
    </div>
    <% } %>
    
    <% if (error && error.length > 0) { %>
    <div class="mb-4 p-3 bg-red-100 border border-red-300 text-red-700 rounded">
        <%= error[0] %>
    </div>
    <% } %>
    
    <div class="overflow-x-auto">
        <table class="min-w-full text-sm">
            <thead class="text-left text-slate-600">
                <tr>
                    <th class="py-2 pr-4">Nama Paket</th>
                    <th class="py-2 pr-4">Profil</th>
                    <th class="py-2 pr-4">Harga</th>
                    <th class="py-2 pr-4">Durasi</th>
                    <th class="py-2 pr-4">Speed Limit</th>
                    <th class="py-2 pr-4">Status</th>
                    <th class="py-2 pr-4">Aksi</th>
                </tr>
            </thead>
            <tbody>
                <% (packages || []).forEach(function(pkg){ %>
                <tr class="border-t border-slate-100">
                    <td class="py-2 pr-4 font-medium"><%= pkg.name %></td>
                    <td class="py-2 pr-4"><%= pkg.profile_name || '-' %></td>
                    <td class="py-2 pr-4">Rp <%= Number(pkg.price).toLocaleString('id-ID') %></td>
                    <td class="py-2 pr-4"><%= pkg.duration_days %> hari</td>
                    <td class="py-2 pr-4">
                        <% if (pkg.rate_limit_rx && pkg.rate_limit_tx) { %>
                            <%= pkg.rate_limit_rx %>/<%= pkg.rate_limit_tx %> Mbps
                        <% } else { %>
                            -
                        <% } %>
                    </td>
                    <td class="py-2 pr-4">
                        <span class="px-2 py-1 text-xs rounded <%= pkg.status === 'active' ? 'bg-green-100 text-green-700' : 'bg-gray-100 text-gray-700' %>">
                            <%= pkg.status === 'active' ? 'Aktif' : 'Nonaktif' %>
                        </span>
                    </td>
                    <td class="py-2 pr-4 flex gap-2">
                        <a href="/packages/pppoe/packages/<%= pkg.id %>/edit" class="px-2 py-1 text-xs rounded border border-slate-300 hover:bg-slate-50 inline-block">
                            Edit
                        </a>
                        <form method="post" action="/packages/pppoe/packages/<%= pkg.id %>/delete" onsubmit="return confirm('Hapus paket ini?');" class="inline">
                            <button type="submit" class="px-2 py-1 text-xs rounded border border-rose-300 text-rose-700 hover:bg-rose-50">
                                Hapus
                            </button>
                        </form>
                    </td>
                </tr>
                <% }) %>
                <% if (!packages || packages.length === 0) { %>
                <tr><td colspan="7" class="py-6 text-center text-slate-500">Belum ada paket. Klik "Tambah Paket" untuk membuat paket baru.</td></tr>
                <% } %>
            </tbody>
        </table>
    </div>
</div>

<div id="modalPackage" class="fixed inset-0 hidden items-center justify-center bg-black/40 p-4">
    <div class="w-full max-w-4xl rounded bg-white p-4 max-h-[90vh] overflow-y-auto">
        <div class="flex items-center justify-between mb-3">
            <h3 class="font-semibold">Tambah / Edit Paket PPPoE</h3>
            <button id="btnClosePackage" class="text-slate-500">âœ•</button>
        </div>
        <form id="formPackage" method="post" action="/packages/pppoe/packages" class="grid grid-cols-1 sm:grid-cols-2 gap-3">
            <div>
                <label class="block text-xs text-slate-600 mb-1">Nama Paket *</label>
                <input name="name" required class="w-full rounded border border-slate-300 px-2 py-1.5" />
            </div>
            <div>
                <label class="block text-xs text-slate-600 mb-1">Profil PPPoE</label>
                <select name="profile_id" class="w-full rounded border border-slate-300 px-2 py-1.5">
                    <option value="">Pilih Profil</option>
                    <% (profiles || []).forEach(function(profile){ %>
                    <option value="<%= profile.id %>"><%= profile.name %></option>
                    <% }) %>
                </select>
            </div>
            <div>
                <label class="block text-xs text-slate-600 mb-1">Harga (Rp) *</label>
                <input name="price" type="number" min="0" step="1000" required class="w-full rounded border border-slate-300 px-2 py-1.5" />
            </div>
            <div>
                <label class="block text-xs text-slate-600 mb-1">Durasi (hari) *</label>
                <input name="duration_days" type="number" min="1" required class="w-full rounded border border-slate-300 px-2 py-1.5" />
            </div>
            <div>
                <label class="block text-xs text-slate-600 mb-1">Status</label>
                <select name="status" class="w-full rounded border border-slate-300 px-2 py-1.5">
                    <option value="active">Aktif</option>
                    <option value="inactive">Nonaktif</option>
                </select>
            </div>
            <div>
                <label class="block text-xs text-slate-600 mb-1">Rate Limit Download (Mbps)</label>
                <input name="rate_limit_rx" type="number" min="0" step="0.1" class="w-full rounded border border-slate-300 px-2 py-1.5" />
            </div>
            <div>
                <label class="block text-xs text-slate-600 mb-1">Rate Limit Upload (Mbps)</label>
                <input name="rate_limit_tx" type="number" min="0" step="0.1" class="w-full rounded border border-slate-300 px-2 py-1.5" />
            </div>
            <div>
                <label class="block text-xs text-slate-600 mb-1">Burst Limit Download (Mbps)</label>
                <input name="burst_limit_rx" type="number" min="0" step="0.1" class="w-full rounded border border-slate-300 px-2 py-1.5" />
            </div>
            <div>
                <label class="block text-xs text-slate-600 mb-1">Burst Limit Upload (Mbps)</label>
                <input name="burst_limit_tx" type="number" min="0" step="0.1" class="w-full rounded border border-slate-300 px-2 py-1.5" />
            </div>
            <div>
                <label class="block text-xs text-slate-600 mb-1">Burst Threshold Download (Mbps)</label>
                <input name="burst_threshold_rx" type="number" min="0" step="0.1" class="w-full rounded border border-slate-300 px-2 py-1.5" />
            </div>
            <div>
                <label class="block text-xs text-slate-600 mb-1">Burst Threshold Upload (Mbps)</label>
                <input name="burst_threshold_tx" type="number" min="0" step="0.1" class="w-full rounded border border-slate-300 px-2 py-1.5" />
            </div>
            <div>
                <label class="block text-xs text-slate-600 mb-1">Burst Time Download (detik)</label>
                <input name="burst_time_rx" type="number" min="0" class="w-full rounded border border-slate-300 px-2 py-1.5" />
            </div>
            <div>
                <label class="block text-xs text-slate-600 mb-1">Burst Time Upload (detik)</label>
                <input name="burst_time_tx" type="number" min="0" class="w-full rounded border border-slate-300 px-2 py-1.5" />
            </div>
            <div class="sm:col-span-2">
                <label class="block text-xs text-slate-600 mb-1">Deskripsi</label>
                <textarea name="description" class="w-full rounded border border-slate-300 px-2 py-1.5" rows="3"></textarea>
            </div>
            <div class="sm:col-span-2 flex justify-end gap-2">
                <button type="button" id="btnCancelPackage" class="px-3 py-1.5 rounded border border-slate-300">Batal</button>
                <button type="submit" class="px-3 py-1.5 rounded bg-blue-600 text-white">Simpan</button>
            </div>
        </form>
    </div>
</div>

<script>
(function(){
    const modal = document.getElementById('modalPackage');
    const openBtn = document.getElementById('btnAddPackage');
    const closeBtn = document.getElementById('btnClosePackage');
    const cancelBtn = document.getElementById('btnCancelPackage');
    const form = document.getElementById('formPackage');
    
    function hide(){ 
        modal.classList.add('hidden'); 
        modal.classList.remove('flex'); 
        form.reset();
        form.action = '/packages/pppoe/packages';
    }
    function show(){ 
        modal.classList.remove('hidden'); 
        modal.classList.add('flex'); 
    }
    
    openBtn?.addEventListener('click', show);
    closeBtn?.addEventListener('click', hide);
    cancelBtn?.addEventListener('click', hide);
    
    window.editPackage = function(id) {
        // TODO: Load package data and populate form
        show();
    };
})();
</script>


