<div class="space-y-6 pb-24">
    <div class="mb-6">
        <div class="flex items-center gap-3 mb-2">
            <a href="/packages/pppoe/profiles" class="text-blue-600 hover:text-blue-800">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                </svg>
            </a>
            <h1 class="text-2xl font-bold text-slate-800"><%= title %></h1>
        </div>
        <p class="text-slate-600">Konfigurasi profil PPPoE dengan rate limiting</p>
    </div>

    <% if (error && error.length > 0) { %>
    <div class="mb-4 p-3 bg-red-100 border border-red-300 text-red-700 rounded">
        <%= error[0] %>
    </div>
    <% } %>

    <div class="bg-white rounded-lg border border-slate-200 p-6">
        <form method="post" action="<%= typeof profile !== 'undefined' ? `/packages/pppoe/profiles/${profile.id}/update` : '/packages/pppoe/profiles/create' %>" class="space-y-6">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Nama Profil -->
                <div>
                    <label class="block text-sm font-medium text-slate-700 mb-2">
                        Nama Profil <span class="text-red-500">*</span>
                    </label>
                    <input 
                        name="name" 
                        type="text" 
                        required 
                        value="<%= typeof profile !== 'undefined' ? profile.name : '' %>"
                        class="w-full rounded-lg border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                        placeholder="Contoh: 10Mbps, Paket-Premium"
                    />
                </div>

                <!-- Local Address -->
                <div>
                    <label class="block text-sm font-medium text-slate-700 mb-2">
                        Local Address
                    </label>
                    <input 
                        name="local_address" 
                        type="text"
                        value="<%= typeof profile !== 'undefined' && profile.local_address ? profile.local_address : '' %>"
                        class="w-full rounded-lg border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                        placeholder="Contoh: 10.10.10.1"
                    />
                </div>

                <!-- Remote Address Pool -->
                <div>
                    <label class="block text-sm font-medium text-slate-700 mb-2">
                        Remote Address Pool
                    </label>
                    <input 
                        name="remote_address_pool" 
                        type="text"
                        value="<%= typeof profile !== 'undefined' && profile.remote_address_pool ? profile.remote_address_pool : '' %>"
                        class="w-full rounded-lg border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                        placeholder="Contoh: pool-pppoe"
                    />
                </div>

                <!-- DNS Server -->
                <div>
                    <label class="block text-sm font-medium text-slate-700 mb-2">
                        DNS Server
                    </label>
                    <input 
                        name="dns_server" 
                        type="text"
                        value="<%= typeof profile !== 'undefined' && profile.dns_server ? profile.dns_server : '' %>"
                        class="w-full rounded-lg border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                        placeholder="Contoh: 8.8.8.8,8.8.4.4"
                    />
                </div>

                <!-- Comment -->
                <div class="md:col-span-2">
                    <label class="block text-sm font-medium text-slate-700 mb-2">
                        Comment / Keterangan
                    </label>
                    <textarea 
                        name="comment" 
                        rows="2"
                        class="w-full rounded-lg border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                        placeholder="Keterangan opsional"
                    ><%= typeof profile !== 'undefined' && profile.comment ? profile.comment : '' %></textarea>
                </div>
            </div>

            <!-- Rate Limiting Section -->
            <div class="border-t border-slate-200 pt-6">
                <h3 class="text-lg font-semibold text-slate-800 mb-4">⚡ Rate Limiting</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">
                            Download Limit (RX) <span class="text-red-500">*</span>
                        </label>
                        <input 
                            name="rate_limit_rx" 
                            type="text"
                            required
                            value="<%= typeof profile !== 'undefined' && profile.rate_limit_rx ? profile.rate_limit_rx : '0' %>"
                            class="w-full rounded-lg border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                            placeholder="Contoh: 10M, 5M (0 = unlimited)"
                        />
                        <p class="text-xs text-slate-500 mt-1">Format: 10M, 5M, 1G. Gunakan 0 untuk unlimited</p>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">
                            Upload Limit (TX) <span class="text-red-500">*</span>
                        </label>
                        <input 
                            name="rate_limit_tx" 
                            type="text"
                            required
                            value="<%= typeof profile !== 'undefined' && profile.rate_limit_tx ? profile.rate_limit_tx : '0' %>"
                            class="w-full rounded-lg border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                            placeholder="Contoh: 2M, 1M (0 = unlimited)"
                        />
                        <p class="text-xs text-slate-500 mt-1">Format: 2M, 1M, 500k. Gunakan 0 untuk unlimited</p>
                    </div>
                </div>
            </div>

            <!-- Burst Limiting Section -->
            <div class="border-t border-slate-200 pt-6">
                <h3 class="text-lg font-semibold text-slate-800 mb-4">🚀 Burst Limiting (Opsional)</h3>
                
                <!-- Burst Calculator -->
                <div class="bg-purple-50 border border-purple-200 rounded-lg p-4 mb-6">
                    <div class="flex items-center justify-between mb-3">
                        <h4 class="font-semibold text-purple-900">
                            <i class="fas fa-calculator mr-2"></i>
                            Burst Queue Calculator
                        </h4>
                        <button type="button" onclick="calculateBurst()" class="px-3 py-1.5 bg-purple-600 text-white rounded text-sm hover:bg-purple-700">
                            <i class="fas fa-calculator mr-1"></i>Hitung
                        </button>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <label class="block text-xs text-purple-700 mb-1">Rate Limit RX</label>
                            <input type="text" id="calc_rate_rx" placeholder="10M" 
                                   class="w-full rounded border border-purple-300 px-2 py-1.5 text-sm" />
                        </div>
                        <div>
                            <label class="block text-xs text-purple-700 mb-1">Burst Multiplier</label>
                            <select id="calc_multiplier" class="w-full rounded border border-purple-300 px-2 py-1.5 text-sm">
                                <option value="1.5">1.5x (Moderate)</option>
                                <option value="2" selected>2x (Standard)</option>
                                <option value="2.5">2.5x (High)</option>
                                <option value="3">3x (Very High)</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-xs text-purple-700 mb-1">Burst Time (seconds)</label>
                            <input type="number" id="calc_time" value="10" min="1" max="60"
                                   class="w-full rounded border border-purple-300 px-2 py-1.5 text-sm" />
                        </div>
                    </div>
                    <div class="mt-3 pt-3 border-t border-purple-200">
                        <p class="text-xs text-purple-700 mb-2">Rekomendasi:</p>
                        <div class="text-xs text-purple-800 space-y-1">
                            <div><strong>Burst Limit:</strong> <span id="calc_result_burst">-</span></div>
                            <div><strong>Burst Threshold:</strong> <span id="calc_result_threshold">-</span></div>
                            <div><strong>Burst Time:</strong> <span id="calc_result_time">-</span></div>
                        </div>
                        <button type="button" onclick="applyBurstCalculation()" class="mt-2 px-3 py-1 bg-purple-600 text-white rounded text-xs hover:bg-purple-700">
                            <i class="fas fa-check mr-1"></i>Terapkan ke Form
                        </button>
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">
                            Burst Download (RX)
                        </label>
                        <input 
                            name="burst_limit_rx" 
                            type="text"
                            value="<%= typeof profile !== 'undefined' && profile.burst_limit_rx ? profile.burst_limit_rx : '' %>"
                            class="w-full rounded-lg border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                            placeholder="Contoh: 20M"
                        />
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">
                            Burst Upload (TX)
                        </label>
                        <input 
                            name="burst_limit_tx" 
                            type="text"
                            value="<%= typeof profile !== 'undefined' && profile.burst_limit_tx ? profile.burst_limit_tx : '' %>"
                            class="w-full rounded-lg border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                            placeholder="Contoh: 4M"
                        />
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">
                            Burst Threshold Download
                        </label>
                        <input 
                            name="burst_threshold_rx" 
                            type="text"
                            value="<%= typeof profile !== 'undefined' && profile.burst_threshold_rx ? profile.burst_threshold_rx : '' %>"
                            class="w-full rounded-lg border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                            placeholder="Contoh: 15M"
                        />
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">
                            Burst Threshold Upload
                        </label>
                        <input 
                            name="burst_threshold_tx" 
                            type="text"
                            value="<%= typeof profile !== 'undefined' && profile.burst_threshold_tx ? profile.burst_threshold_tx : '' %>"
                            class="w-full rounded-lg border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                            placeholder="Contoh: 3M"
                        />
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">
                            Burst Time Download
                        </label>
                        <input 
                            name="burst_time_rx" 
                            type="text"
                            value="<%= typeof profile !== 'undefined' && profile.burst_time_rx ? profile.burst_time_rx : '' %>"
                            class="w-full rounded-lg border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                            placeholder="Contoh: 10s"
                        />
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">
                            Burst Time Upload
                        </label>
                        <input 
                            name="burst_time_tx" 
                            type="text"
                            value="<%= typeof profile !== 'undefined' && profile.burst_time_tx ? profile.burst_time_tx : '' %>"
                            class="w-full rounded-lg border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                            placeholder="Contoh: 10s"
                        />
                    </div>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="flex justify-end gap-3 pt-6 border-t border-slate-200">
                <a 
                    href="/packages/pppoe/profiles" 
                    class="px-4 py-2 text-slate-600 bg-slate-100 hover:bg-slate-200 rounded-lg transition-colors"
                >
                    Batal
                </a>
                <button 
                    type="submit" 
                    class="px-6 py-2 bg-blue-600 text-white hover:bg-blue-700 rounded-lg transition-colors"
                >
                    <%= typeof profile !== 'undefined' ? 'Update Profil' : 'Simpan Profil' %>
                </button>
            </div>
        </form>
    </div>
</div>

<script>
function parseSpeed(speed) {
    if (!speed) return 0;
    speed = speed.toString().trim();
    const num = parseFloat(speed);
    if (speed.toUpperCase().includes('G')) return num * 1000;
    if (speed.toUpperCase().includes('M')) return num;
    if (speed.toUpperCase().includes('K')) return num / 1000;
    return num;
}

function formatSpeed(mbps) {
    if (mbps >= 1000) return (mbps / 1000).toFixed(1) + 'G';
    if (mbps >= 1) return mbps.toFixed(1) + 'M';
    return (mbps * 1000).toFixed(0) + 'K';
}

function calculateBurst() {
    const rateRx = document.getElementById('calc_rate_rx').value;
    const multiplier = parseFloat(document.getElementById('calc_multiplier').value);
    const time = document.getElementById('calc_time').value;
    
    if (!rateRx) {
        alert('Masukkan Rate Limit RX terlebih dahulu');
        return;
    }
    
    const rateMbps = parseSpeed(rateRx);
    const burstLimit = rateMbps * multiplier;
    const threshold = rateMbps * 0.8; // 80% of rate limit
    
    document.getElementById('calc_result_burst').textContent = formatSpeed(burstLimit) + ' (RX/TX)';
    document.getElementById('calc_result_threshold').textContent = formatSpeed(threshold) + ' (RX/TX)';
    document.getElementById('calc_result_time').textContent = time + 's (RX/TX)';
    
    // Store calculation results
    window.burstCalc = {
        burstLimit: formatSpeed(burstLimit),
        threshold: formatSpeed(threshold),
        time: time + 's'
    };
}

function applyBurstCalculation() {
    if (!window.burstCalc) {
        alert('Hitung terlebih dahulu!');
        return;
    }
    
    document.querySelector('input[name="burst_limit_rx"]').value = window.burstCalc.burstLimit;
    document.querySelector('input[name="burst_limit_tx"]').value = window.burstCalc.burstLimit;
    document.querySelector('input[name="burst_threshold_rx"]').value = window.burstCalc.threshold;
    document.querySelector('input[name="burst_threshold_tx"]').value = window.burstCalc.threshold;
    document.querySelector('input[name="burst_time_rx"]').value = window.burstCalc.time;
    document.querySelector('input[name="burst_time_tx"]').value = window.burstCalc.time;
    
    alert('Nilai burst telah diterapkan ke form!');
}
</script>

