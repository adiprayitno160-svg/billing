<div class="rounded border border-slate-200 bg-white p-4">
    <div class="flex items-center justify-between mb-4">
        <h2 class="text-lg font-semibold">Daftar Profil PPPoE</h2>
        <div class="flex gap-2">
            <a href="/packages/pppoe/profiles/new" class="px-3 py-1.5 rounded bg-green-600 text-white text-sm hover:bg-green-700">
                ‚ûï Tambah Manual
            </a>
            <form method="post" action="/packages/pppoe/profiles/sync" class="inline">
                <button type="submit" class="px-3 py-1.5 rounded bg-blue-600 text-white text-sm hover:bg-blue-700">
                    üîÑ Sync dari MikroTik
                </button>
            </form>
        </div>
    </div>
    
    <% if (success && success.length > 0) { %>
    <div class="mb-4 p-3 bg-green-100 border border-green-300 text-green-700 rounded">
        <%= success[0] %>
    </div>
    <% } %>
    
    <% if (error && error.length > 0) { %>
    <div class="mb-4 p-3 bg-red-100 border border-red-300 text-red-700 rounded">
        <%= error[0] %>
    </div>
    <% } %>
    
    <div class="overflow-x-auto">
        <table class="min-w-full text-xs">
            <thead class="text-left text-slate-600 bg-slate-50">
                <tr>
                    <th class="py-2 px-2 sticky left-0 bg-slate-50 z-10">Nama</th>
                    <th class="py-2 px-2">Local Address</th>
                    <th class="py-2 px-2">Remote Pool</th>
                    <th class="py-2 px-2">DNS Server</th>
                    <th class="py-2 px-2 bg-blue-50">üì• Rate RX</th>
                    <th class="py-2 px-2 bg-green-50">üì§ Rate TX</th>
                    <th class="py-2 px-2 bg-purple-50" colspan="4">üöÄ Burst Limiting RX (Download)</th>
                    <th class="py-2 px-2 bg-orange-50" colspan="4">üöÄ Burst Limiting TX (Upload)</th>
                    <th class="py-2 px-2">Comment</th>
                    <th class="py-2 px-2 text-center sticky right-0 bg-slate-50 z-10">Aksi</th>
                </tr>
                <tr class="bg-slate-100">
                    <th class="py-1 px-2 sticky left-0 bg-slate-100 z-10"></th>
                    <th class="py-1 px-2"></th>
                    <th class="py-1 px-2"></th>
                    <th class="py-1 px-2"></th>
                    <th class="py-1 px-2 text-xs bg-blue-50">Limit</th>
                    <th class="py-1 px-2 text-xs bg-green-50">Limit</th>
                    <th class="py-1 px-2 text-xs bg-purple-50">Burst</th>
                    <th class="py-1 px-2 text-xs bg-purple-50">Threshold</th>
                    <th class="py-1 px-2 text-xs bg-purple-50">Time</th>
                    <th class="py-1 px-2 text-xs bg-purple-50"></th>
                    <th class="py-1 px-2 text-xs bg-orange-50">Burst</th>
                    <th class="py-1 px-2 text-xs bg-orange-50">Threshold</th>
                    <th class="py-1 px-2 text-xs bg-orange-50">Time</th>
                    <th class="py-1 px-2 text-xs bg-orange-50"></th>
                    <th class="py-1 px-2"></th>
                    <th class="py-1 px-2 sticky right-0 bg-slate-100 z-10"></th>
                </tr>
            </thead>
            <tbody>
                <% (profiles || []).forEach(function(profile){ %>
                <tr class="border-t border-slate-100 hover:bg-slate-50">
                    <td class="py-2 px-2 font-medium sticky left-0 bg-white hover:bg-slate-50 z-10"><%= profile.name %></td>
                    <td class="py-2 px-2 text-xs"><%= profile.local_address || '-' %></td>
                    <td class="py-2 px-2 text-xs"><%= profile.remote_address_pool || '-' %></td>
                    <td class="py-2 px-2 text-xs"><%= profile.dns_server || '-' %></td>
                    <td class="py-2 px-2 bg-blue-50">
                        <span class="inline-flex items-center px-2 py-1 rounded text-xs bg-blue-100 text-blue-700 font-medium">
                            <%= profile.rate_limit_rx || '0' %>
                        </span>
                    </td>
                    <td class="py-2 px-2 bg-green-50">
                        <span class="inline-flex items-center px-2 py-1 rounded text-xs bg-green-100 text-green-700 font-medium">
                            <%= profile.rate_limit_tx || '0' %>
                        </span>
                    </td>
                    <!-- Burst RX (Download) -->
                    <td class="py-2 px-2 text-xs bg-purple-50">
                        <span class="text-purple-700 font-medium"><%= profile.burst_limit_rx || '-' %></span>
                    </td>
                    <td class="py-2 px-2 text-xs bg-purple-50">
                        <span class="text-purple-600"><%= profile.burst_threshold_rx || '-' %></span>
                    </td>
                    <td class="py-2 px-2 text-xs bg-purple-50">
                        <span class="text-purple-600"><%= profile.burst_time_rx || '-' %></span>
                    </td>
                    <td class="py-2 px-2 text-xs bg-purple-50"></td>
                    <!-- Burst TX (Upload) -->
                    <td class="py-2 px-2 text-xs bg-orange-50">
                        <span class="text-orange-700 font-medium"><%= profile.burst_limit_tx || '-' %></span>
                    </td>
                    <td class="py-2 px-2 text-xs bg-orange-50">
                        <span class="text-orange-600"><%= profile.burst_threshold_tx || '-' %></span>
                    </td>
                    <td class="py-2 px-2 text-xs bg-orange-50">
                        <span class="text-orange-600"><%= profile.burst_time_tx || '-' %></span>
                    </td>
                    <td class="py-2 px-2 text-xs bg-orange-50"></td>
                    <!-- Comment -->
                    <td class="py-2 px-2 text-xs text-slate-600"><%= profile.comment || '-' %></td>
                    <!-- Actions -->
                    <td class="py-2 px-2 sticky right-0 bg-white hover:bg-slate-50 z-10">
                        <div class="flex items-center justify-center gap-2">
                            <a href="/packages/pppoe/profiles/<%= profile.id %>/edit" 
                               class="text-blue-600 hover:text-blue-800" 
                               title="Edit">
                                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                    <path d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z"/>
                                </svg>
                            </a>
                            <button onclick="deleteProfile(<%= profile.id %>, '<%= profile.name %>')" 
                                    class="text-red-600 hover:text-red-800" 
                                    title="Hapus">
                                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd"/>
                                </svg>
                            </button>
                        </div>
                    </td>
                </tr>
                <% }) %>
                <% if (!profiles || profiles.length === 0) { %>
                <tr><td colspan="16" class="py-6 text-center text-slate-500">Belum ada profil. Klik "Sync dari MikroTik" untuk mengambil data dari MikroTik.</td></tr>
                <% } %>
            </tbody>
        </table>
    </div>
    
    <div class="mt-4 p-3 bg-blue-50 border border-blue-200 rounded text-sm text-blue-700">
        <p class="font-semibold mb-2">üí° Info & Penjelasan Kolom:</p>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-3 text-xs">
            <div>
                <p class="font-semibold mb-1">üì• Download (RX):</p>
                <ul class="list-disc list-inside space-y-1">
                    <li><strong>Rate Limit RX:</strong> Batas kecepatan download normal</li>
                    <li><strong>Burst RX:</strong> Speed maksimal download saat burst</li>
                    <li><strong>Threshold RX:</strong> Batas traffic sebelum burst aktif</li>
                    <li><strong>Time RX:</strong> Durasi burst aktif (contoh: 10s, 30s)</li>
                </ul>
            </div>
            <div>
                <p class="font-semibold mb-1">üì§ Upload (TX):</p>
                <ul class="list-disc list-inside space-y-1">
                    <li><strong>Rate Limit TX:</strong> Batas kecepatan upload normal</li>
                    <li><strong>Burst TX:</strong> Speed maksimal upload saat burst</li>
                    <li><strong>Threshold TX:</strong> Batas traffic sebelum burst aktif</li>
                    <li><strong>Time TX:</strong> Durasi burst aktif (contoh: 10s, 30s)</li>
                </ul>
            </div>
        </div>
        <div class="mt-3 pt-3 border-t border-blue-300">
            <ul class="list-disc list-inside space-y-1 text-xs">
                <li><strong>Sync dari MikroTik:</strong> Otomatis ambil & update profil dari router MikroTik</li>
                <li><strong>Tambah Manual:</strong> Buat profil baru secara manual (tidak tersync ke MikroTik)</li>
                <li><strong>Burst Limiting:</strong> Memberikan speed ekstra sementara saat bandwidth tersedia</li>
            </ul>
        </div>
    </div>
</div>

<script>
function deleteProfile(id, name) {
    if (confirm(`Apakah Anda yakin ingin menghapus profil "${name}"?\n\n‚ö†Ô∏è Profil yang sudah digunakan oleh paket tidak dapat dihapus.`)) {
        fetch(`/packages/pppoe/profiles/${id}`, {
            method: 'DELETE',
            headers: {
                'Content-Type': 'application/json',
                'Accept': 'application/json'
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert('‚úÖ Profil berhasil dihapus!');
                location.reload();
            } else {
                alert('‚ùå Gagal menghapus profil: ' + (data.error || 'Unknown error'));
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('‚ùå Terjadi kesalahan saat menghapus profil');
        });
    }
}
</script>
