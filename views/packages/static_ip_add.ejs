<div class="rounded border border-slate-200 bg-white p-4">
    <div class="flex items-center justify-between mb-4">
        <h2 class="text-lg font-semibold">Tambah Paket IP Static</h2>
        <a href="/packages/static-ip" class="px-3 py-1.5 rounded border border-slate-300 text-slate-700 hover:bg-slate-50">
            ← Kembali
        </a>
    </div>
    
    <% if (error && error.length > 0) { %>
    <div class="mb-4 p-3 bg-red-100 border border-red-300 text-red-700 rounded">
        <%= error[0] %>
    </div>
    <% } %>
    
    <form method="post" action="/packages/static-ip" class="grid grid-cols-1 sm:grid-cols-2 gap-4">
        <!-- Baris 1: Nama Paket & Status -->
        <div>
            <label class="block text-sm font-medium text-slate-700 mb-1">Nama Paket *</label>
            <input name="name" required class="w-full rounded border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" />
        </div>
        <div>
            <label class="block text-sm font-medium text-slate-700 mb-1">Status</label>
            <select name="status" class="w-full rounded border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                <option value="active">Aktif</option>
                <option value="inactive">Nonaktif</option>
            </select>
        </div>

        <!-- Baris 2: Harga & Durasi -->
        <div>
            <label class="block text-sm font-medium text-slate-700 mb-1">Harga (Rp) *</label>
            <input name="price" type="number" min="0" step="1000" required class="w-full rounded border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" />
        </div>
        <div>
            <label class="block text-sm font-medium text-slate-700 mb-1">Durasi (hari) *</label>
            <input 
                id="duration_days"
                name="duration_days" 
                type="number" 
                min="1" 
                required 
                value="30"
                class="w-full rounded border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"
                onchange="calculateStaticIpExpiry()"
            />
            <div id="static_ip_expiry_preview" class="text-xs text-blue-600 mt-1 font-medium"></div>
        </div>

        <!-- Baris 3: Parent Upload & Parent Download -->
        <div>
            <label class="block text-sm font-medium text-slate-700 mb-1">Parent Upload *</label>
            <input name="parent_upload_name" type="text" required placeholder="Contoh: UPLOAD ALL" class="w-full rounded border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" />
            <p class="text-xs text-slate-500 mt-1">Ketik nama parent upload yang sudah ada di MikroTik</p>
        </div>
        <div>
            <label class="block text-sm font-medium text-slate-700 mb-1">Parent Download *</label>
            <input name="parent_download_name" type="text" required placeholder="Contoh: DOWNLOAD ALL" class="w-full rounded border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" />
            <p class="text-xs text-slate-500 mt-1">Ketik nama parent download yang sudah ada di MikroTik</p>
        </div>

        <!-- Baris 4: Limit Upload & Download -->
        <div>
            <label class="block text-sm font-medium text-slate-700 mb-1">Max Limit Upload *</label>
            <input name="max_limit_upload" required placeholder="10M" class="w-full rounded border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" />
            <p class="text-xs text-slate-500 mt-1">Contoh: 10M, 5M, 1M</p>
        </div>
        <div>
            <label class="block text-sm font-medium text-slate-700 mb-1">Limit At Upload</label>
            <input name="limit_at_upload" placeholder="mis: 2M" class="w-full rounded border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" />
        </div>
        <div>
            <label class="block text-sm font-medium text-slate-700 mb-1">Max Limit Download *</label>
            <input name="max_limit_download" required placeholder="20M" class="w-full rounded border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" />
            <p class="text-xs text-slate-500 mt-1">Contoh: 20M, 10M, 5M</p>
        </div>
        <div>
            <label class="block text-sm font-medium text-slate-700 mb-1">Limit At Download</label>
            <input name="limit_at_download" placeholder="mis: 2M" class="w-full rounded border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" />
        </div>

        <!-- Baris 5: Max Clients & Sistem Share -->
        <div>
            <label class="block text-sm font-medium text-slate-700 mb-1">Max Clients *</label>
            <input name="max_clients" type="number" min="1" required placeholder="1" class="w-full rounded border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" />
            <p class="text-xs text-slate-500 mt-1">Jumlah maksimal client yang bisa menggunakan paket ini</p>
        </div>
        <div>
            <label class="block text-sm font-medium text-slate-700 mb-1">Sistem Share</label>
            <div class="p-3 bg-blue-50 border border-blue-200 rounded text-sm text-blue-700">
                <p class="font-medium mb-1">ℹ️ Informasi Sistem Share:</p>
                <p>• Jika Max Clients > 1, bandwidth akan dibagi rata</p>
                <p>• Contoh: 10M untuk 2 clients = 5M per client</p>
                <p>• Child parent akan diambil dari parent paket (view only)</p>
            </div>
        </div>

        <!-- Garis Pembatas -->
        <div class="sm:col-span-2 border-t border-slate-200 my-4"></div>

        <!-- Child Template untuk Pelanggan -->
        <div class="sm:col-span-2">
            <h3 class="text-lg font-semibold text-slate-700 mb-3">📋 Child Template untuk Pelanggan</h3>
            <div class="p-4 bg-slate-50 border border-slate-200 rounded">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-slate-600 mb-1">Nama Paket *</label>
                        <input name="child_upload_name" required readonly placeholder="PAKET_NAME_UPLOAD" class="w-full rounded border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" />
                        <p class="text-xs text-slate-500 mt-1">Diisi otomatis dari Nama Paket (format: NAMA_PAKET_UPLOAD)</p>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-slate-600 mb-1">Nama Paket *</label>
                        <input name="child_download_name" required readonly placeholder="PAKET_NAME_DOWNLOAD" class="w-full rounded border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" />
                        <p class="text-xs text-slate-500 mt-1">Diisi otomatis dari Nama Paket (format: NAMA_PAKET_DOWNLOAD)</p>
                    </div>
                </div>
                <div class="mt-4 grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-slate-600 mb-1">Max Upload</label>
                        <input name="child_upload_limit" placeholder="5M" class="w-full rounded border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" />
                        <p class="text-xs text-slate-500 mt-1">Batas upload per pelanggan</p>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-slate-600 mb-1">Max Download</label>
                        <input name="child_download_limit" placeholder="10M" class="w-full rounded border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" />
                        <p class="text-xs text-slate-500 mt-1">Batas download per pelanggan</p>
                    </div>
                </div>
                <div class="mt-4 grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-slate-600 mb-1">Child Limit-At Upload</label>
                        <input name="child_limit_at_upload" placeholder="2M" class="w-full rounded border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" />
                        <p class="text-xs text-slate-500 mt-1">Nilai limit-at upload (opsional)</p>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-slate-600 mb-1">Child Limit-At Download</label>
                        <input name="child_limit_at_download" placeholder="2M" class="w-full rounded border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" />
                        <p class="text-xs text-slate-500 mt-1">Nilai limit-at download (opsional)</p>
                    </div>
                </div>
                
                <div class="mt-4 grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-slate-600 mb-1">Queue Type Download</label>
                        <select name="child_queue_type_download" class="w-full rounded border border-slate-300 px-3 py-2">
                            <option value="pcq-download-default" selected>pcq-download-default</option>
                            <option value="default">default</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-slate-600 mb-1">Queue Type Upload</label>
                        <select name="child_queue_type_upload" class="w-full rounded border border-slate-300 px-3 py-2">
                            <option value="pcq-upload-default" selected>pcq-upload-default</option>
                            <option value="default">default</option>
                        </select>
                    </div>
                </div>
                <div class="mt-4 grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-slate-600 mb-1">Priority Download</label>
                        <select name="child_priority_download" class="w-full rounded border border-slate-300 px-3 py-2">
                            <% for (var p=1;p<=8;p++){ %>
                            <option value="<%= p %>" <%= p===8 ? 'selected' : '' %>><%= p %></option>
                            <% } %>
                        </select>
                        <div class="mt-3">
                            <label class="block text-sm font-medium text-slate-600 mb-1">Child Burst Download</label>
                            <input name="child_burst_download" placeholder="10M" class="w-full rounded border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" />
                            <p class="text-xs text-slate-500 mt-1">Nilai burst-limit download (opsional)</p>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-slate-600 mb-1">Priority Upload</label>
                        <select name="child_priority_upload" class="w-full rounded border border-slate-300 px-3 py-2">
                            <% for (var p=1;p<=8;p++){ %>
                            <option value="<%= p %>" <%= p===8 ? 'selected' : '' %>><%= p %></option>
                            <% } %>
                        </select>
                        <div class="mt-3">
                            <label class="block text-sm font-medium text-slate-600 mb-1">Child Burst Upload</label>
                            <input name="child_burst_upload" placeholder="10M" class="w-full rounded border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" />
                            <p class="text-xs text-slate-500 mt-1">Nilai burst-limit upload (opsional)</p>
                        </div>
                    </div>
                </div>
                <div class="mt-4 grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-slate-600 mb-1">Child Burst Threshold Upload</label>
                        <input name="child_burst_threshold_upload" placeholder="otomatis dari burst-limit (mis: 70%)" class="w-full rounded border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" />
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-slate-600 mb-1">Child Burst Threshold Download</label>
                        <input name="child_burst_threshold_download" placeholder="otomatis dari burst-limit (mis: 70%)" class="w-full rounded border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" />
                    </div>
                </div>
                <div class="mt-4 grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-slate-600 mb-1">Child Burst Time Upload</label>
                        <input name="child_burst_time_upload" placeholder="mis: 20s" class="w-full rounded border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" />
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-slate-600 mb-1">Child Burst Time Download</label>
                        <input name="child_burst_time_download" placeholder="mis: 20s" class="w-full rounded border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" />
                    </div>
                </div>
                <div class="mt-3 p-3 bg-blue-50 border border-blue-200 rounded text-sm text-blue-700">
                    <p class="font-medium mb-1">ℹ️ Informasi Child Template:</p>
                    <p>• Child ini akan dibuat otomatis di MikroTik untuk setiap pelanggan</p>
                    <p>• Pelanggan A akan menggunakan child ini di bawah parent paket</p>
                    <p>• Speed akan dibagi sesuai max_clients yang ditentukan</p>
                    <p>• Template ini akan disimpan di database untuk referensi</p>
                </div>
            </div>
        </div>

        <div class="sm:col-span-2">
            <label class="block text-sm font-medium text-slate-700 mb-1">Deskripsi</label>
            <textarea name="description" class="w-full rounded border border-slate-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500" rows="3" placeholder="Deskripsi paket (opsional)"></textarea>
        </div>
        <div class="sm:col-span-2 flex justify-end gap-3">
            <a href="/packages/static-ip" class="px-4 py-2 rounded border border-slate-300 text-slate-700 hover:bg-slate-50">
                Batal
            </a>
            <button type="submit" class="px-4 py-2 rounded bg-blue-600 text-white hover:bg-blue-700">
                Simpan Paket
            </button>
        </div>
        <script>
            (function() {
                var nameInput = document.querySelector('input[name="name"]');
                var upload = document.querySelector('input[name="child_upload_name"]');
                var download = document.querySelector('input[name="child_download_name"]');
                function sync() {
                    var raw = (nameInput && nameInput.value) ? nameInput.value.trim() : '';
                    if (upload) upload.value = raw ? 'UP-' + raw : '';
                    if (download) download.value = raw;
                }
                if (nameInput) {
                    nameInput.addEventListener('input', sync);
                    window.addEventListener('DOMContentLoaded', sync);
                }
            })();
            
            // Calculate expiry date for Static IP
            function calculateStaticIpExpiry() {
                const durationDays = parseInt(document.getElementById('duration_days').value) || 0;
                if (durationDays <= 0) {
                    document.getElementById('static_ip_expiry_preview').textContent = '';
                    return;
                }
                
                const today = new Date();
                const expiryDate = new Date(today);
                expiryDate.setDate(today.getDate() + durationDays);
                
                const options = { year: 'numeric', month: 'long', day: 'numeric' };
                const formattedDate = expiryDate.toLocaleDateString('id-ID', options);
                
                document.getElementById('static_ip_expiry_preview').textContent = 
                    `📅 Jika aktivasi hari ini: Berakhir pada ${formattedDate}`;
            }
            
            // Initialize on page load
            document.addEventListener('DOMContentLoaded', function() {
                calculateStaticIpExpiry();
            });
        </script>
    </form>
</div>
