<!DOCTYPE html>
<html lang="id">
<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title><%= typeof title !== 'undefined' ? title : 'Billing' %></title>
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
	<link rel="stylesheet" href="/assets/styles.css" />
	<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
	<!-- Chart.js for Interface Traffic Realtime -->
	<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
	<script src="https://cdn.jsdelivr.net/npm/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
</head>
<body class="bg-gray-50 text-gray-800 font-sans" style="font-family: 'Inter', ui-sans-serif, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, 'Noto Sans', 'Apple Color Emoji', 'Segoe UI Emoji';">
    <div class="flex h-screen overflow-hidden">
        <!-- Sidebar -->
        <aside id="sidebar" class="w-64 bg-blue-600 text-white border-r border-blue-700 h-full overflow-y-auto shadow-lg flex-shrink-0 transition-all duration-300">
			<%- include('../partials/sidebar') %>
		</aside>
        
        <!-- Main Content -->
        <main id="main-content" class="flex-1 h-full overflow-y-auto pb-16 transition-all duration-300">
            <div class="w-full p-6">
                <header class="mb-6">
                    <%- include('../partials/header') %>
                </header>
                <%- include('../partials/flash') %>
                <section>
                    <%- body %>
                </section>
            </div>
		</main>
    </div>
    <%- include('../partials/footer') %>
<script src="/assets/sidebar.js" defer></script>
<script src="/assets/dashboard.js" defer></script>

<!-- Real-time Clock Update -->
<script>
(function() {
    function updateClock() {
        const now = new Date();
        
        // Format time: HH:MM:SS
        const hours = String(now.getHours()).padStart(2, '0');
        const minutes = String(now.getMinutes()).padStart(2, '0');
        const seconds = String(now.getSeconds()).padStart(2, '0');
        const timeString = `${hours}:${minutes}:${seconds}`;
        
        // Format date: Hari, DD Bulan YYYY
        const days = ['Minggu', 'Senin', 'Selasa', 'Rabu', 'Kamis', 'Jumat', 'Sabtu'];
        const months = ['Jan', 'Feb', 'Mar', 'Apr', 'Mei', 'Jun', 'Jul', 'Agu', 'Sep', 'Okt', 'Nov', 'Des'];
        const dayName = days[now.getDay()];
        const day = now.getDate();
        const month = months[now.getMonth()];
        const year = now.getFullYear();
        const dateString = `${dayName}, ${day} ${month} ${year}`;
        
        // Update DOM
        const timeElement = document.getElementById('currentTime');
        const dateElement = document.getElementById('currentDate');
        
        if (timeElement) timeElement.textContent = timeString;
        if (dateElement) dateElement.textContent = dateString;
    }
    
    // Update immediately on page load
    updateClock();
    
    // Update every second
    setInterval(updateClock, 1000);
})();
</script>

<!-- Auto logout after 5 minutes of inactivity -->
<script>
(function() {
    let idleTime = 0;
    const IDLE_TIMEOUT = 5; // 5 minutes
    const LOGOUT_URL = '/logout';
    
    // Don't log out if already on login page
    const currentPath = window.location.pathname;
    if (currentPath === '/login' || currentPath === '/auth/login' || currentPath === '/kasir/login') {
        return;
    }
    
    // Track if user is logged in
    const isLoggedIn = document.body.getAttribute('data-logged-in') === 'true' || 
                      window.location.pathname !== '/login';
    
    if (!isLoggedIn) {
        return;
    }
    
    // Reset idle time on user activity
    function resetIdleTime() {
        idleTime = 0;
        // Remove warning if exists
        const warning = document.getElementById('idleWarning');
        if (warning) {
            warning.remove();
        }
    }
    
    // Listen for user activity
    document.addEventListener('mousemove', resetIdleTime);
    document.addEventListener('keypress', resetIdleTime);
    document.addEventListener('click', resetIdleTime);
    document.addEventListener('scroll', resetIdleTime);
    document.addEventListener('touchstart', resetIdleTime);
    
    // Check idle time every minute
    setInterval(function() {
        idleTime++;
        
        // Show warning at 4 minutes
        if (idleTime === IDLE_TIMEOUT - 1) {
            // Only show if warning doesn't already exist
            if (!document.getElementById('idleWarning')) {
                const warningDiv = document.createElement('div');
                warningDiv.id = 'idleWarning';
                warningDiv.className = 'fixed bottom-4 right-4 bg-orange-500 text-white px-6 py-4 rounded-lg shadow-2xl z-50 animate-bounce';
                warningDiv.innerHTML = `
                    <div class="flex items-center gap-3">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                        </svg>
                        <div>
                            <div class="font-bold">Tidak Ada Aktivitas</div>
                            <div class="text-sm">Anda akan logout otomatis dalam 1 menit...</div>
                        </div>
                        <button onclick="document.getElementById('idleWarning').remove(); idleTime = 0;" class="ml-4 px-3 py-1 bg-white text-orange-500 rounded font-semibold hover:bg-gray-100">
                            Tetap Login
                        </button>
                    </div>
                `;
                document.body.appendChild(warningDiv);
            }
        }
        
        // Logout after 5 minutes
        if (idleTime >= IDLE_TIMEOUT) {
            console.log('Auto-logout due to inactivity...');
            // Redirect to logout endpoint
            window.location.href = LOGOUT_URL;
        }
    }, 60000); // Check every 1 minute
})();
</script>
</body>
</html>


