====================================================================
ğŸ” DEBUG BURST LIMITING DATA DARI MIKROTIK
====================================================================

MASALAH:
Data burst limiting (RX/TX, threshold, time) MASIH KOSONG setelah 
sync dari MikroTik.

PENYEBAB YANG MUNGKIN:
1. MikroTik tidak mengirim data burst limiting
2. Format data dari MikroTik berbeda dari yang kita expect
3. Profile di MikroTik memang tidak ada burst setting

====================================================================
LANGKAH DEBUGGING (WAJIB IKUTI URUTAN INI):
====================================================================

STEP 1: UPDATE CODE (Di Server)
--------------------------------------------------------------------
cd /opt/billing
git pull origin main
npm run build
pm2 restart billing-app  # atau billing-system/billing

âœ… Tunggu sampai PM2 restart selesai (Â±10 detik)


STEP 2: SYNC DARI MIKROTIK (Di Browser)
--------------------------------------------------------------------
1. Login ke sistem billing
2. Buka: /packages/pppoe/profiles
3. Klik tombol: "ğŸ”„ Sync dari MikroTik"
4. Tunggu notifikasi sukses

âš ï¸ JANGAN REFRESH DULU! Lanjut ke step 3.


STEP 3: CEK LOG PM2 (Di Server)
--------------------------------------------------------------------
pm2 logs billing-app --lines 200

Cari output seperti ini untuk SETIAP profile:

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ” Processing profile: Paket-10M
  ğŸ“‹ All fields from MikroTik: .id, name, local-address, remote-address, dns-server, rate-limit, ...
  
  ğŸ” Checking separate fields: {
    'rx-rate': 'NOT FOUND',
    'tx-rate': 'NOT FOUND',
    'burst-rate': 'NOT FOUND',
    'burst-threshold': 'NOT FOUND',
    'burst-time': 'NOT FOUND'
  }
  
  ğŸ” Parsing rate-limit string: "10M/2M 20M/4M 15M/3M 10s/10s 8"
  ğŸ“ String length: 31
  ğŸ“¦ Split parts (5): [ '10M/2M', '20M/4M', '15M/3M', '10s/10s', '8' ]
  
  âœ… Rate limits: RX="10M", TX="2M"
  âœ… Burst limits: RX="20M", TX="4M"
  âœ… Burst thresholds: RX="15M", TX="3M"
  âœ… Burst times: RX="10s", TX="10s"
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”


STEP 4: ANALISA LOG
--------------------------------------------------------------------

SKENARIO A: rate-limit string KOSONG
--------------------------------------------------------------------
âš ï¸  No rate-limit field for Paket-10M

ARTINYA:
- Profile di MikroTik TIDAK punya rate limiting sama sekali
- Perlu diset manual di MikroTik atau via form web UI

FIX:
Di MikroTik Winbox:
  PPP > Profiles > [Pilih profile] > Tab Rate Limit
  Set: Rate Limit, Burst Limit, Burst Threshold, Burst Time


SKENARIO B: rate-limit ada TAPI burst data KOSONG
--------------------------------------------------------------------
ğŸ” Parsing rate-limit string: "10M/2M"
ğŸ“ String length: 6
ğŸ“¦ Split parts (1): [ '10M/2M' ]

âœ… Rate limits: RX="10M", TX="2M"
âš ï¸  No burst-rate part (parts[1] is undefined)
âš ï¸  No burst-threshold part (parts[2] is undefined)
âš ï¸  No burst-time part (parts[3] is undefined)

ARTINYA:
- Profile HANYA punya rate limit normal (10M/2M)
- TIDAK ada burst setting di MikroTik

FIX:
Di MikroTik, tambahkan burst setting ke profile tersebut.


SKENARIO C: rate-limit string PENUH (ADA SEMUA)
--------------------------------------------------------------------
ğŸ” Parsing rate-limit string: "10M/2M 20M/4M 15M/3M 10s/10s 8"
ğŸ“¦ Split parts (5): [ '10M/2M', '20M/4M', '15M/3M', '10s/10s', '8' ]

âœ… Rate limits: RX="10M", TX="2M"
âœ… Burst limits: RX="20M", TX="4M"
âœ… Burst thresholds: RX="15M", TX="3M"
âœ… Burst times: RX="10s", TX="10s"

ARTINYA:
- âœ… Parsing SUKSES!
- Data burst SEHARUSNYA sudah masuk database
- Refresh browser untuk lihat hasil


SKENARIO D: Format ANEH (Tidak sesuai standard)
--------------------------------------------------------------------
ğŸ” Parsing rate-limit string: "rx-rate=10M tx-rate=2M ..."

ARTINYA:
- Format dari MikroTik berbeda dari standard
- Perlu update parsing code

FIX:
Kirim screenshot log ke developer untuk analisa format.


====================================================================
SETELAH DEBUGGING:
====================================================================

JIKA BURST DATA BERHASIL DI-PARSE:
--------------------------------------------------------------------
1. Refresh halaman /packages/pppoe/profiles
2. Burst data seharusnya sudah muncul
3. âœ… SELESAI!


JIKA BURST DATA MASIH KOSONG (SKENARIO A atau B):
--------------------------------------------------------------------
Berarti MikroTik memang tidak punya burst setting.

Set manual di MikroTik:
1. Buka MikroTik Winbox
2. PPP > Profiles
3. Pilih profile yang mau diset
4. Tab "Rate Limit"
5. Set burst parameter:
   - Burst Limit: 20M/4M (2x dari rate normal)
   - Burst Threshold: 15M/3M (1.5x dari rate normal)
   - Burst Time: 10s/10s (durasi burst)
6. Apply
7. Kembali ke billing system
8. Klik "Sync dari MikroTik" lagi
9. âœ… Data burst sekarang sudah ada!


ATAU SET VIA WEB UI:
--------------------------------------------------------------------
1. /packages/pppoe/profiles/[id]/edit
2. Isi field:
   - Burst Download (RX): 20M
   - Burst Upload (TX): 4M
   - Threshold Download: 15M
   - Threshold Upload: 3M
   - Time Download: 10s
   - Time Upload: 10s
3. Save
4. âœ… Data burst tersimpan!


====================================================================
QUICK COMMANDS (COPY-PASTE):
====================================================================

# Update & restart
cd /opt/billing && git pull origin main && npm run build && pm2 restart billing-app

# Cek log setelah sync
pm2 logs billing-app --lines 200 | grep -A 20 "Processing profile"

====================================================================
CONTOH LOG YANG BAGUS (SUKSES):
====================================================================

ğŸ” Processing profile: Paket-110k
  ğŸ“‹ All fields from MikroTik: .id, name, local-address, rate-limit, ...
  ğŸ” Parsing rate-limit string: "10M/10M 50M/50M 15M/15M 10s/10s 8"
  ğŸ“¦ Split parts (5): [ '10M/10M', '50M/50M', '15M/15M', '10s/10s', '8' ]
  âœ… Rate limits: RX="10M", TX="10M"
  âœ… Burst limits: RX="50M", TX="50M"
  âœ… Burst thresholds: RX="15M", TX="15M"
  âœ… Burst times: RX="10s", TX="10s"

ğŸ“Š Burst Data: {
  'burst-limit-rx': '50M',
  'burst-limit-tx': '50M',
  'burst-threshold-rx': '15M',
  'burst-threshold-tx': '15M',
  'burst-time-rx': '10s',
  'burst-time-tx': '10s'
}
âœ… Profil Paket-110k berhasil di-sync

====================================================================
NEED HELP?
====================================================================

Kirim screenshot log PM2 (hasil dari step 3) untuk analisa lebih lanjut.

====================================================================

