====================================================================
🔍 DEBUG IMPORT EXCEL CUSTOMERS - GAGAL 20 DARI 20
====================================================================

MASALAH:
Import Excel gagal semua: "Berhasil: 0, Gagal: 20"

PENYEBAB YANG MUNGKIN:
1. ❌ Nama kolom Excel tidak sesuai format
2. ❌ Data telepon atau email sudah ada di database
3. ❌ Data Nama atau Telepon kosong
4. ❌ Format file Excel corrupt atau tidak bisa dibaca

====================================================================
SOLUSI: UPDATE & TEST DENGAN LOGGING DETAIL
====================================================================

STEP 1: Update Code di Server
--------------------------------------------------------------------
cd /opt/billing
git pull origin main
npm run build
pm2 restart billing-app


STEP 2: Monitor Log (Terminal Terpisah)
--------------------------------------------------------------------
pm2 logs billing-app --lines 0

Biarkan terminal ini terbuka untuk monitoring.


STEP 3: Test Import (Di Browser)
--------------------------------------------------------------------
1. Buka /customers/list
2. Klik "📥 Import Excel"
3. Pilih file Excel Anda
4. Klik "Import Data"
5. JANGAN TUTUP BROWSER! Lihat notifikasi error


STEP 4: CEK LOG PM2 (Di Terminal)
--------------------------------------------------------------------
Setelah klik Import, log akan muncul seperti ini untuk SETIAP baris:

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📝 Processing row 2: {
  Nama: 'John Doe',
  Telepon: '08123456789',
  Email: 'john@example.com',
  All keys: 'Nama, Telepon, Email, Alamat'
}
  🔍 Checking phone: "08123456789"
  ✅ Phone OK
  🔍 Checking email: "john@example.com"
  ✅ Email OK
  💾 Inserting customer: { 
    name: 'John Doe', 
    phone: '08123456789',
    email: 'john@example.com',
    connectionType: 'pppoe',
    status: 'active'
  }
  ✅ SUCCESS: Row 2 imported!
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━


STEP 5: ANALISA LOG
--------------------------------------------------------------------

CASE A: Nama kolom Excel SALAH
--------------------------------------------------------------------
📝 Processing row 2: {
  Nama: 'EMPTY',
  Telepon: 'EMPTY',
  Email: 'EMPTY',
  All keys: 'Name, Phone, Email, Address'  <-- SALAH!
}
  ❌ Validation failed: Nama dan Telepon harus diisi

ARTINYA:
Kolom di Excel pakai bahasa Inggris (Name, Phone) tapi 
sistem expect bahasa Indonesia (Nama, Telepon)

FIX:
Ganti header Excel jadi:
- Nama (bukan Name)
- Telepon (bukan Phone)
- Email (sudah benar)
- Alamat (bukan Address)


CASE B: Data Nama atau Telepon KOSONG
--------------------------------------------------------------------
📝 Processing row 2: {
  Nama: 'EMPTY',
  Telepon: '08123456789',
  ...
}
  ❌ Validation failed: Nama dan Telepon harus diisi (Nama: "undefined", Telepon: "08123456789")

ARTINYA:
Ada baris yang Nama-nya kosong

FIX:
Isi semua kolom Nama dan Telepon di Excel


CASE C: Telepon DUPLICATE (Sudah Ada)
--------------------------------------------------------------------
📝 Processing row 2: {
  Nama: 'John Doe',
  Telepon: '08123456789',
  ...
}
  🔍 Checking phone: "08123456789"
  ❌ Duplicate phone: Pelanggan dengan telepon "08123456789" sudah ada

ARTINYA:
Customer dengan nomor telepon ini sudah ada di database

FIX:
1. Hapus customer lama dari database dulu
2. Atau ganti nomor telepon di Excel


CASE D: Email DUPLICATE
--------------------------------------------------------------------
  🔍 Checking email: "john@example.com"
  ❌ Duplicate email: Email "john@example.com" sudah digunakan oleh pelanggan lain

ARTINYA:
Email ini sudah dipakai customer lain

FIX:
1. Kosongkan kolom Email di Excel (email opsional)
2. Atau ganti dengan email berbeda


CASE E: Database ERROR
--------------------------------------------------------------------
  ❌ ERROR at row 2: Column 'xxx' cannot be null

ARTINYA:
Ada kolom database yang harus diisi tapi kosong

FIX:
Kirim screenshot error lengkap


====================================================================
FORMAT EXCEL YANG BENAR:
====================================================================

Header (Baris 1) - HARUS PERSIS SEPERTI INI:
--------------------------------------------------------------------
Nama | Telepon | Email | Alamat | Kode Pelanggan | Tipe Koneksi | Status | Latitude | Longitude | PPPoE Username

WAJIB DIISI:
- Nama
- Telepon

OPSIONAL (boleh kosong):
- Email
- Alamat
- Kode Pelanggan
- Tipe Koneksi (default: pppoe)
- Status (default: inactive)
- Latitude
- Longitude
- PPPoE Username


Contoh Data (Baris 2 dst):
--------------------------------------------------------------------
John Doe | 08123456789 | john@example.com | Jl. Merdeka 123 | | pppoe | Aktif | | | john123


====================================================================
TIPS MEMBUAT EXCEL YANG BENAR:
====================================================================

1. Buka Excel atau Google Sheets
2. Baris 1 (Header): Copy-paste ini PERSIS:
   
   Nama	Telepon	Email	Alamat	Kode Pelanggan	Tipe Koneksi	Status	Latitude	Longitude	PPPoE Username

3. Baris 2 dst: Isi data customer
4. Save as: .xlsx atau .xls
5. Upload ke sistem


====================================================================
CEK DATABASE (Jika Duplicate Error):
====================================================================

Jika banyak error "sudah ada", cek database:

mysql -u root -p billing
SELECT name, phone, email FROM customers ORDER BY id DESC LIMIT 20;

Jika mau hapus semua dan import ulang:
TRUNCATE TABLE customers;  # ⚠️ HATI-HATI! Hapus semua data!


====================================================================
QUICK COMMANDS (Server):
====================================================================

# Update & restart
cd /opt/billing && git pull origin main && npm run build && pm2 restart billing-app

# Monitor log
pm2 logs billing-app --lines 0

# Cek customer terakhir di database
mysql -u root -p billing -e "SELECT id, name, phone FROM customers ORDER BY id DESC LIMIT 5;"


====================================================================
AFTER FIXING:
====================================================================

1. Fix Excel sesuai error yang muncul di log
2. Upload ulang
3. Cek log lagi
4. Ulangi sampai "Berhasil: 20, Gagal: 0" 

====================================================================

