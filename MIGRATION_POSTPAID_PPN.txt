-- Migration untuk Postpaid PPN dan Device Rental
-- Jalankan SQL ini di phpMyAdmin atau MySQL client Anda

USE billing;

-- Tambah kolom PPN dan Device Fee ke tabel invoices
ALTER TABLE invoices 
ADD COLUMN IF NOT EXISTS ppn_rate DECIMAL(5,2) DEFAULT 0 COMMENT 'PPN rate (percentage)',
ADD COLUMN IF NOT EXISTS ppn_amount DECIMAL(15,2) DEFAULT 0 COMMENT 'PPN amount in Rupiah',
ADD COLUMN IF NOT EXISTS device_fee DECIMAL(15,2) DEFAULT 0 COMMENT 'Device rental fee';

-- Setup System Settings untuk PPN dan Device Rental
INSERT INTO system_settings (setting_key, setting_value, setting_category, setting_description, created_at, updated_at)
VALUES 
    ('ppn_enabled', 'true', 'billing', 'Aktifkan perhitungan PPN pada invoice postpaid', NOW(), NOW()),
    ('ppn_rate', '11', 'billing', 'Rate PPN dalam persen (%)', NOW(), NOW()),
    ('device_rental_enabled', 'true', 'billing', 'Aktifkan biaya sewa perangkat', NOW(), NOW()),
    ('device_rental_fee', '50000', 'billing', 'Biaya sewa perangkat per bulan (Rupiah)', NOW(), NOW())
ON DUPLICATE KEY UPDATE 
    setting_value = VALUES(setting_value),
    setting_description = VALUES(setting_description),
    updated_at = NOW();

SELECT 'Migration completed successfully!' AS Status;
