═══════════════════════════════════════════════════════════════════════════════
  UPDATE SERVER v2.1.12 - AUTO LOGOUT 5 MENIT
═══════════════════════════════════════════════════════════════════════════════

📌 IMPORTANT: Backup dulu sebelum update!
┌─────────────────────────────────────────────────────────────────────────────┐
│ ⚠️  Fitur ini akan logout otomatis semua user yang inactive selama 5 menit │
└─────────────────────────────────────────────────────────────────────────────┘

═══════════════════════════════════════════════════════════════════════════════
🔄 QUICK UPDATE (COPY-PASTE)
═══════════════════════════════════════════════════════════════════════════════

cd /opt/billing && \
git pull origin main && \
npm install && \
npm run build && \
npm install --production && \
pm2 restart billing-app --update-env

═══════════════════════════════════════════════════════════════════════════════
📋 DETAILED UPDATE STEPS
═══════════════════════════════════════════════════════════════════════════════

1. Backup Database (Optional tapi disarankan):
   ──────────────────────────────────────────────────────────────────────────
   mysqldump -u username -p nama_database > backup_$(date +%Y%m%d_%H%M%S).sql

2. Masuk ke Direktori Aplikasi:
   ──────────────────────────────────────────────────────────────────────────
   cd /opt/billing

3. Git Pull:
   ──────────────────────────────────────────────────────────────────────────
   git pull origin main

4. Install Dependencies:
   ──────────────────────────────────────────────────────────────────────────
   npm install

5. Build TypeScript:
   ──────────────────────────────────────────────────────────────────────────
   npm run build

6. Install Production Dependencies:
   ──────────────────────────────────────────────────────────────────────────
   npm install --production

7. Restart PM2:
   ──────────────────────────────────────────────────────────────────────────
   pm2 restart billing-app --update-env

8. Check Status:
   ──────────────────────────────────────────────────────────────────────────
   pm2 status
   pm2 logs billing-app --lines 50

═══════════════════════════════════════════════════════════════════════════════
✨ FITUR BARU v2.1.12
═══════════════════════════════════════════════════════════════════════════════

🔒 AUTO LOGOUT - 5 MENIT INACTIVITY
─────────────────────────────────────────────────────────────────────────────
✅ Session otomatis logout setelah 5 menit tanpa aktivitas
✅ Warning popup muncul di menit ke-4
✅ Tombol "Tetap Login" untuk cancel auto logout
✅ Tracking aktivitas: mouse, keyboard, click, scroll, touch
✅ Rolling session: aktivitas user mereset timer

🎯 USER EXPERIENCE:
─────────────────────────────────────────────────────────────────────────────
1. Login → Session aktif
2. No activity 3 menit → Masih aktif
3. No activity 4 menit → ⚠️ Warning popup muncul
4. User klik "Tetap Login" → Timer reset, session lanjut
5. No activity 5 menit → Auto logout, redirect ke /login

═══════════════════════════════════════════════════════════════════════════════
⚠️  PENTING UNTUK DIKETAHUI
═══════════════════════════════════════════════════════════════════════════════

CHANGES:
─────────────────────────────────────────────────────────────────────────────
❌ BEFORE: Session bisa berlangsung lama tanpa limit
✅ AFTER:  Session otomatis logout setelah 5 menit idle

IMPACT:
─────────────────────────────────────────────────────────────────────────────
• User harus login ulang jika inactive > 5 menit
• Rolling session: user aktif tidak akan logout
• Security meningkat: tidak ada abandoned sessions

BENEFITS:
─────────────────────────────────────────────────────────────────────────────
✅ Prevents unauthorized access dari abandoned sessions
✅ Automatic session cleanup
✅ Clear visual warning sebelum logout
✅ User-friendly dengan tombol cancel

═══════════════════════════════════════════════════════════════════════════════
🧪 TESTING AFTER UPDATE
═══════════════════════════════════════════════════════════════════════════════

Login & Test Auto Logout:
─────────────────────────────────────────────────────────────────────────────
1. Login ke aplikasi
2. Biarkan idle selama 4 menit
3. ✅ Popup warning muncul (orange, bottom-right)
4. Klik "Tetap Login" → ✅ warning hilang
5. Biarkan idle lagi
6. ✅ Auto logout di menit ke-5
7. ✅ Redirect ke /login page

Test Rolling Session:
─────────────────────────────────────────────────────────────────────────────
1. Login
2. Gerakkan mouse terus-menerus (atau scroll)
3. ✅ Tidak ada warning
4. ✅ Session tetap aktif

═══════════════════════════════════════════════════════════════════════════════
🚨 TROUBLESHOOTING
═══════════════════════════════════════════════════════════════════════════════

Problem: Auto logout tidak bekerja
Solution:
─────────────────────────────────────────────────────────────────────────────
1. Check PM2 status: pm2 status
2. Check logs: pm2 logs billing-app --lines 100
3. Clear cache browser
4. Hard refresh: Ctrl + Shift + R

Problem: Warning popup tidak muncul
Solution:
─────────────────────────────────────────────────────────────────────────────
1. Check browser console untuk errors
2. Check apakah user sudah di halaman login
3. Verify JavaScript enabled

Problem: Session expired terlalu cepat
Solution:
─────────────────────────────────────────────────────────────────────────────
• Timer di-reset setiap request (rolling session)
• User yang aktif tidak akan logout
• Hanya logout jika benar-benar idle 5 menit

═══════════════════════════════════════════════════════════════════════════════
📁 FILES CHANGED
═══════════════════════════════════════════════════════════════════════════════

Modified:
─────────────────────────────────────────────────────────────────────────────
✅ src/server.ts           - Session config (5 min timeout)
✅ views/layouts/main.ejs  - Auto logout script

Version Files:
─────────────────────────────────────────────────────────────────────────────
✅ VERSION, VERSION_MAJOR, VERSION_HOTFIX
✅ package.json

Documentation:
─────────────────────────────────────────────────────────────────────────────
✅ CHANGELOG_v2.1.12.md
✅ UPDATE_SERVER_v2.1.12.txt (file ini)

═══════════════════════════════════════════════════════════════════════════════
✅ UPDATE SELESAI
═══════════════════════════════════════════════════════════════════════════════

Check Version:
─────────────────────────────────────────────────────────────────────────────
cat VERSION
# Should show: 2.1.12

Check PM2:
─────────────────────────────────────────────────────────────────────────────
pm2 status
pm2 logs billing-app --lines 20

Login & Test:
─────────────────────────────────────────────────────────────────────────────
1. Buka browser
2. Login ke aplikasi
3. Test auto logout feature

═══════════════════════════════════════════════════════════════════════════════
📞 SUPPORT
═══════════════════════════════════════════════════════════════════════════════

Jika ada masalah:
1. Check log: pm2 logs billing-app
2. Check error messages
3. Verify semua files updated
4. Restart PM2: pm2 restart billing-app

═══════════════════════════════════════════════════════════════════════════════

Release: v2.1.12
Date: 30 Oktober 2025
Type: Security Feature
Status: ✅ Production Ready

═══════════════════════════════════════════════════════════════════════════════

